
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../developer_guide/">
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>API Reference - diffWOFOST documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="diffWOFOST documentation" class="md-header__button md-logo" aria-label="diffWOFOST documentation" data-md-component="logo">
      
  <img src="../logo/diffwofost.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            diffWOFOST documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/WUR-AI/diffwofost" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
  </div>
  <div class="md-source__repository">
    diffWOFOST
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  
  Introduction

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../installation/" class="md-tabs__link">
          
  
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../CONTRIBUTING/" class="md-tabs__link">
          
  
  
  How to Contribute

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  API Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="diffWOFOST documentation" class="md-nav__button md-logo" aria-label="diffWOFOST documentation" data-md-component="logo">
      
  <img src="../logo/diffwofost.png" alt="logo">

    </a>
    diffWOFOST documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/WUR-AI/diffwofost" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
  </div>
  <div class="md-source__repository">
    diffWOFOST
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Introduction
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    diffWOFOST
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../citation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Citation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../acknowledgements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Acknowledgements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../references/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    References
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../run_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How to run a model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Example notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    How to Contribute
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    How to Contribute
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Developer guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crop-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Crop modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crop modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology" class="md-nav__link">
    <span class="md-ellipsis">
      
        DVS_Phenology
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DVS_Phenology">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.device" class="md-nav__link">
    <span class="md-ellipsis">
      
        device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.calc_rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        calc_rates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.integrate" class="md-nav__link">
    <span class="md-ellipsis">
      
        integrate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.get_variable" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_variable
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        DVS_Partitioning
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DVS_Partitioning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning.integrate" class="md-nav__link">
    <span class="md-ellipsis">
      
        integrate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning.calc_rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        calc_rates
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation" class="md-nav__link">
    <span class="md-ellipsis">
      
        WOFOST72_Assimilation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WOFOST72_Assimilation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.device" class="md-nav__link">
    <span class="md-ellipsis">
      
        device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.calc_rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        calc_rates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.integrate" class="md-nav__link">
    <span class="md-ellipsis">
      
        integrate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      
        WOFOST_Leaf_Dynamics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WOFOST_Leaf_Dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.device" class="md-nav__link">
    <span class="md-ellipsis">
      
        device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.calc_rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        calc_rates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.integrate" class="md-nav__link">
    <span class="md-ellipsis">
      
        integrate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      
        WOFOST_Root_Dynamics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WOFOST_Root_Dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.device" class="md-nav__link">
    <span class="md-ellipsis">
      
        device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.calc_rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        calc_rates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.integrate" class="md-nav__link">
    <span class="md-ellipsis">
      
        integrate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-under-development" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utility (under development)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utility (under development)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.Configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.Configuration.from_pcse_config_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_pcse_config_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.Configuration.update_output_variable_lists" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_output_variable_lists
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        ComputeConfig
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ComputeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig.get_device" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig.set_device" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig.get_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig.set_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig.reset_to_defaults" class="md-nav__link">
    <span class="md-ellipsis">
      
        reset_to_defaults
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.engine.Engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        Engine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.utils.EngineTestHelper" class="md-nav__link">
    <span class="md-ellipsis">
      
        EngineTestHelper
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crop-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Crop modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crop modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology" class="md-nav__link">
    <span class="md-ellipsis">
      
        DVS_Phenology
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DVS_Phenology">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.device" class="md-nav__link">
    <span class="md-ellipsis">
      
        device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.calc_rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        calc_rates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.integrate" class="md-nav__link">
    <span class="md-ellipsis">
      
        integrate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.get_variable" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_variable
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        DVS_Partitioning
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DVS_Partitioning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning.integrate" class="md-nav__link">
    <span class="md-ellipsis">
      
        integrate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning.calc_rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        calc_rates
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation" class="md-nav__link">
    <span class="md-ellipsis">
      
        WOFOST72_Assimilation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WOFOST72_Assimilation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.device" class="md-nav__link">
    <span class="md-ellipsis">
      
        device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.calc_rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        calc_rates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.integrate" class="md-nav__link">
    <span class="md-ellipsis">
      
        integrate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      
        WOFOST_Leaf_Dynamics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WOFOST_Leaf_Dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.device" class="md-nav__link">
    <span class="md-ellipsis">
      
        device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.calc_rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        calc_rates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.integrate" class="md-nav__link">
    <span class="md-ellipsis">
      
        integrate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      
        WOFOST_Root_Dynamics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WOFOST_Root_Dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.device" class="md-nav__link">
    <span class="md-ellipsis">
      
        device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.calc_rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        calc_rates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.integrate" class="md-nav__link">
    <span class="md-ellipsis">
      
        integrate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-under-development" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utility (under development)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utility (under development)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.Configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.Configuration.from_pcse_config_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_pcse_config_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.Configuration.update_output_variable_lists" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_output_variable_lists
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        ComputeConfig
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ComputeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig.get_device" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig.set_device" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_device
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig.get_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig.set_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.config.ComputeConfig.reset_to_defaults" class="md-nav__link">
    <span class="md-ellipsis">
      
        reset_to_defaults
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.engine.Engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        Engine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffwofost.physical_models.utils.EngineTestHelper" class="md-nav__link">
    <span class="md-ellipsis">
      
        EngineTestHelper
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                



                  
  



  
  


<h1 id="_1"></h1>
<h2 id="crop-modules"><strong>Crop modules</strong></h2>


<div class="doc doc-object doc-class">



<h3 id="diffwofost.physical_models.crop.phenology.DVS_Phenology" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">diffwofost.physical_models.crop.phenology.DVS_Phenology</span>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pcse.base.SimulationObject">SimulationObject</span></code></p>



        <p>Implements the algorithms for phenologic development in WOFOST.</p>
<p>Phenologic development in WOFOST is expresses using a unitless scale
which takes the values 0 at emergence, 1 at Anthesis (flowering) and
2 at maturity. This type of phenological development is mainly
representative for cereal crops. All other crops that are simulated
with WOFOST are forced into this scheme as well, although this may
not be appropriate for all crops. For example, for potatoes
development stage 1 represents the start of tuber formation rather
than flowering.</p>
<p>Phenological development is mainly governed by temperature and can
be modified by the effects of day length and vernalization during
the period before Anthesis. After Anthesis, only temperature
influences the development rate.</p>
<p><strong>Simulation parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>TSUMEM</td>
<td>Temperature sum from sowing to emergence</td>
<td>SCr</td>
<td></td>
</tr>
<tr>
<td>TBASEM</td>
<td>Base temperature for emergence</td>
<td>SCr</td>
<td></td>
</tr>
<tr>
<td>TEFFMX</td>
<td>Maximum effective temperature for emergence</td>
<td>SCr</td>
<td></td>
</tr>
<tr>
<td>TSUM1</td>
<td>Temperature sum from emergence to anthesis</td>
<td>SCr</td>
<td></td>
</tr>
<tr>
<td>TSUM2</td>
<td>Temperature sum from anthesis to maturity</td>
<td>SCr</td>
<td></td>
</tr>
<tr>
<td>IDSL</td>
<td>Switch for development options: temp only (0), +daylength</td>
<td>SCr</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td>(1), +vernalization (&gt;=2)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>DLO</td>
<td>Optimal daylength for phenological development</td>
<td>SCr</td>
<td>hr</td>
</tr>
<tr>
<td>DLC</td>
<td>Critical daylength for phenological development</td>
<td>SCr</td>
<td>hr</td>
</tr>
<tr>
<td>DVSI</td>
<td>Initial development stage at emergence (may be &gt;0 for</td>
<td>SCr</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td>transplanted crops)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>DVSEND</td>
<td>Final development stage</td>
<td>SCr</td>
<td>-</td>
</tr>
<tr>
<td>DTSMTB</td>
<td>Daily increase in temperature sum as a function of daily</td>
<td>TCr</td>
<td></td>
</tr>
<tr>
<td></td>
<td>mean temperature</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>State variables</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>DVS</td>
<td>Development stage</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>TSUM</td>
<td>Temperature sum</td>
<td>N</td>
<td></td>
</tr>
<tr>
<td>TSUME</td>
<td>Temperature sum for emergence</td>
<td>N</td>
<td></td>
</tr>
<tr>
<td>DOS</td>
<td>Day of sowing</td>
<td>N</td>
<td>-</td>
</tr>
<tr>
<td>DOE</td>
<td>Day of emergence</td>
<td>N</td>
<td>-</td>
</tr>
<tr>
<td>DOA</td>
<td>Day of Anthesis</td>
<td>N</td>
<td>-</td>
</tr>
<tr>
<td>DOM</td>
<td>Day of maturity</td>
<td>N</td>
<td>-</td>
</tr>
<tr>
<td>DOH</td>
<td>Day of harvest</td>
<td>N</td>
<td>-</td>
</tr>
<tr>
<td>STAGE</td>
<td>Current stage (<code>emerging|vegetative|reproductive|mature</code>)</td>
<td>N</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Rate variables</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>DTSUME</td>
<td>Increase in temperature sum for emergence</td>
<td>N</td>
<td></td>
</tr>
<tr>
<td>DTSUM</td>
<td>Increase in temperature sum for anthesis or maturity</td>
<td>N</td>
<td></td>
</tr>
<tr>
<td>DVR</td>
<td>Development rate</td>
<td>Y</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>External dependencies:</strong></p>
<p>None</p>
<p><strong>Signals sent or handled</strong></p>
<p><code>DVS_Phenology</code> sends the <code>crop_finish</code> signal when maturity is
reached and the <code>end_type</code> is 'maturity' or 'earliest'.</p>
<p><strong>Gradient mapping (which parameters have a gradient):</strong></p>
<table>
<thead>
<tr>
<th>Output</th>
<th>Parameters influencing it</th>
</tr>
</thead>
<tbody>
<tr>
<td>DVS</td>
<td>...</td>
</tr>
<tr>
<td>TSUM</td>
<td>...</td>
</tr>
</tbody>
</table>
<p>[!NOTE]
Notice that the gradient ∂DVS/∂TEFFMX is zero.</p>
<p>[!NOTE]
The parameter IDSL it is not differentiable since it is a switch.</p>

          











<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            initialize (diffwofost.physical_models.crop.phenology.DVS_Phenology.initialize)" href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.initialize">initialize</a></code></b>
            –
            <div class="doc-md-description">
              <p>:param day: start date of the simulation</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            calc_rates (diffwofost.physical_models.crop.phenology.DVS_Phenology.calc_rates)" href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.calc_rates">calc_rates</a></code></b>
            –
            <div class="doc-md-description">
              <p>Compute daily phenological development rates.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            integrate (diffwofost.physical_models.crop.phenology.DVS_Phenology.integrate)" href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.integrate">integrate</a></code></b>
            –
            <div class="doc-md-description">
              <p>Integrate phenology states and manage stage transitions.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            get_variable (diffwofost.physical_models.crop.phenology.DVS_Phenology.get_variable)" href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.get_variable">get_variable</a></code></b>
            –
            <div class="doc-md-description">
              <p>Return the value of the specified state or rate variable.</p>
            </div>
          </li>
    </ul>




<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            device


  
      property
   (diffwofost.physical_models.crop.phenology.DVS_Phenology.device)" href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.device">device</a></code></b>
          –
          <div class="doc-md-description">
            <p>Get device from ComputeConfig.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            dtype


  
      property
   (diffwofost.physical_models.crop.phenology.DVS_Phenology.dtype)" href="#diffwofost.physical_models.crop.phenology.DVS_Phenology.dtype">dtype</a></code></b>
          –
          <div class="doc-md-description">
            <p>Get dtype from ComputeConfig.</p>
          </div>
        </li>
    </ul>




<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="diffwofost.physical_models.crop.phenology.DVS_Phenology.device" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">device</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">device</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get device from ComputeConfig.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="diffwofost.physical_models.crop.phenology.DVS_Phenology.dtype" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">dtype</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">dtype</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get dtype from ComputeConfig.</p>

          
    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.phenology.DVS_Phenology.initialize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">initialize</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">initialize</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">kiosk</span><span class="p">,</span> <span class="n">parvalues</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>:param day: start date of the simulation</p>
<p>:param kiosk: variable kiosk of this PCSE  instance
:param parvalues: <code>ParameterProvider</code> object providing parameters as
        key/value pairs</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/phenology.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">kiosk</span><span class="p">,</span> <span class="n">parvalues</span><span class="p">):</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;:param day: start date of the simulation</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">    :param kiosk: variable kiosk of this PCSE  instance</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">    :param parvalues: `ParameterProvider` object providing parameters as</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">            key/value pairs</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Parameters</span><span class="p">(</span><span class="n">parvalues</span><span class="p">)</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span> <span class="o">=</span> <span class="n">_get_params_shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>    <span class="c1"># Initialize vernalisation for IDSL&gt;=2</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>    <span class="c1"># It has to be done in advance to get the correct params_shape</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="n">IDSL</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">IDSL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="p">)</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">IDSL</span> <span class="o">=</span> <span class="n">IDSL</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">IDSL</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span> <span class="o">!=</span> <span class="p">():</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span> <span class="o">=</span> <span class="n">Vernalisation</span><span class="p">(</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>                <span class="n">day</span><span class="p">,</span> <span class="n">kiosk</span><span class="p">,</span> <span class="n">parvalues</span><span class="p">,</span> <span class="n">dvs_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>            <span class="p">)</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span> <span class="o">=</span> <span class="n">Vernalisation</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">kiosk</span><span class="p">,</span> <span class="n">parvalues</span><span class="p">)</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="o">.</span><span class="n">params_shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">:</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="o">.</span><span class="n">params_shape</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>    <span class="c1"># After Vernalisation initialization the final params_shape may have changed.</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_cast_and_broadcast_params</span><span class="p">()</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>    <span class="c1"># Create scalar constants once at the beginning to avoid recreating them</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="c1"># Initialize rates and kiosk</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RateVariables</span><span class="p">(</span><span class="n">kiosk</span><span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span> <span class="o">=</span> <span class="n">kiosk</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_connect_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_CROP_FINISH</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">crop_finish</span><span class="p">)</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>    <span class="c1"># Define initial states</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="n">DVS</span><span class="p">,</span> <span class="n">DOS</span><span class="p">,</span> <span class="n">DOE</span><span class="p">,</span> <span class="n">STAGE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_initial_stage</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="n">DVS</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">DVS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="c1"># Initialize all date tensors with -1 (not yet occurred)</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>    <span class="n">DOS</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">DOS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="n">DOE</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">DOE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>    <span class="n">DOA</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>    <span class="n">DOM</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>    <span class="n">DOH</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>    <span class="n">STAGE</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">STAGE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="c1"># Also ensure TSUM and TSUME are properly shaped</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="n">TSUM</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="p">)</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="n">TSUME</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>    <span class="p">)</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StateVariables</span><span class="p">(</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="n">kiosk</span><span class="p">,</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>        <span class="n">publish</span><span class="o">=</span><span class="s2">&quot;DVS&quot;</span><span class="p">,</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="n">TSUME</span><span class="o">=</span><span class="n">TSUME</span><span class="p">,</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="n">DVS</span><span class="o">=</span><span class="n">DVS</span><span class="p">,</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="n">DOS</span><span class="o">=</span><span class="n">DOS</span><span class="p">,</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="n">DOE</span><span class="o">=</span><span class="n">DOE</span><span class="p">,</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="n">DOA</span><span class="o">=</span><span class="n">DOA</span><span class="p">,</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="n">DOM</span><span class="o">=</span><span class="n">DOM</span><span class="p">,</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="n">DOH</span><span class="o">=</span><span class="n">DOH</span><span class="p">,</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="n">STAGE</span><span class="o">=</span><span class="n">STAGE</span><span class="p">,</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.phenology.DVS_Phenology.calc_rates" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calc_rates</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calc_rates</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">drv</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute daily phenological development rates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>day</code></b>
              (<code><span title="datetime.date">date</span></code>)
          –
          <div class="doc-md-description">
            <p>Current simulation date.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>drv</code></b>
          –
          <div class="doc-md-description">
            <p>Meteorological driver object with at least TEMP and LAT.</p>
          </div>
        </li>
    </ul>


<details class="logic" open>
  <summary>Logic</summary>
  <ol>
<li>Photoperiod reduction (DVRED) if IDSL &gt;= 1 using daylength.</li>
<li>Vernalisation factor (VERNFAC) if IDSL &gt;= 2 and in vegetative stage.</li>
<li>Stage-specific:</li>
<li>emerging: temperature sum for emergence (DTSUME), DVR via TSUMEM.</li>
<li>vegetative: temperature sum (DTSUM) scaled by VERNFAC and DVRED.</li>
<li>reproductive: temperature sum (DTSUM) only temperature-driven.</li>
<li>mature: all rates zero.</li>
</ol>
</details>

<details class="sets" open>
  <summary>Sets</summary>
  <p>r.DTSUME, r.DTSUM, r.DVR.</p>
</details>

<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="PCSEError">PCSEError</span></code>
            –
          <div class="doc-md-description">
            <p>If STAGE unrecognized.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/phenology.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="nd">@prepare_rates</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">drv</span><span class="p">):</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute daily phenological development rates.</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">        day (datetime.date): Current simulation date.</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">        drv: Meteorological driver object with at least TEMP and LAT.</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">    Logic:</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        1. Photoperiod reduction (DVRED) if IDSL &gt;= 1 using daylength.</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">        2. Vernalisation factor (VERNFAC) if IDSL &gt;= 2 and in vegetative stage.</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">        3. Stage-specific:</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">           - emerging: temperature sum for emergence (DTSUME), DVR via TSUMEM.</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">           - vegetative: temperature sum (DTSUM) scaled by VERNFAC and DVRED.</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">           - reproductive: temperature sum (DTSUM) only temperature-driven.</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">           - mature: all rates zero.</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">    Sets:</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">        r.DTSUME, r.DTSUM, r.DVR.</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">        PCSEError: If STAGE unrecognized.</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>    <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>    <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>    <span class="c1"># Day length sensitivity</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>    <span class="n">DAYLP</span> <span class="o">=</span> <span class="n">daylength</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">drv</span><span class="o">.</span><span class="n">LAT</span><span class="p">)</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>    <span class="n">DAYLP_t</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">DAYLP</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>    <span class="c1"># Compute DVRED conditionally based on IDSL &gt;= 1</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>    <span class="n">safe_den</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">DLO</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">DLC</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>    <span class="n">safe_den</span> <span class="o">=</span> <span class="n">safe_den</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">safe_den</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">)</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="n">dvred_active</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">((</span><span class="n">DAYLP_t</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">DLC</span><span class="p">)</span> <span class="o">/</span> <span class="n">safe_den</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>    <span class="n">DVRED</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">IDSL</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dvred_active</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ones</span><span class="p">)</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="c1"># Vernalisation factor - always compute if module exists</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>    <span class="n">VERNFAC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ones</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;vernalisation&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>        <span class="c1"># Always call calc_rates (it handles stage internally now)</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="o">.</span><span class="n">calc_rates</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">drv</span><span class="p">)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>        <span class="c1"># Apply vernalisation only where IDSL &gt;= 2 AND in vegetative stage</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="n">is_vegetative</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>        <span class="n">VERNFAC</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>            <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">IDSL</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">is_vegetative</span><span class="p">,</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">[</span><span class="s2">&quot;VERNFAC&quot;</span><span class="p">],</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ones</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="p">)</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>    <span class="n">TEMP</span> <span class="o">=</span> <span class="n">_get_drv</span><span class="p">(</span><span class="n">drv</span><span class="o">.</span><span class="n">TEMP</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>    <span class="c1"># Initialize all rate variables</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DTSUME</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zeros</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DTSUM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zeros</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DVR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zeros</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>    <span class="c1"># Compute rates for emerging stage (STAGE == 0)</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>    <span class="n">is_emerging</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">is_emerging</span><span class="p">):</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="n">temp_diff</span> <span class="o">=</span> <span class="n">TEMP</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">TBASEM</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>        <span class="c1"># Ensure the maximum effective temperature difference is non-negative</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>        <span class="n">max_diff</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">TEFFMX</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">TBASEM</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>        <span class="n">dtsume_emerging</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">temp_diff</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>        <span class="n">dtsume_emerging</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">dtsume_emerging</span><span class="p">,</span> <span class="n">max_diff</span><span class="p">)</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>        <span class="n">safe_den</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">TSUMEM</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="n">safe_den</span> <span class="o">=</span> <span class="n">safe_den</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">safe_den</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="n">dvr_emerging</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">dtsume_emerging</span> <span class="o">/</span> <span class="n">safe_den</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>        <span class="n">r</span><span class="o">.</span><span class="n">DTSUME</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_emerging</span><span class="p">,</span> <span class="n">dtsume_emerging</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">DTSUME</span><span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>        <span class="n">r</span><span class="o">.</span><span class="n">DVR</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_emerging</span><span class="p">,</span> <span class="n">dvr_emerging</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">DVR</span><span class="p">)</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>    <span class="c1"># Compute rates for vegetative stage (STAGE == 1)</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>    <span class="n">is_vegetative</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">is_vegetative</span><span class="p">):</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>        <span class="n">dtsum_vegetative</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">DTSMTB</span><span class="p">(</span><span class="n">TEMP</span><span class="p">)</span> <span class="o">*</span> <span class="n">VERNFAC</span> <span class="o">*</span> <span class="n">DVRED</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="n">safe_den</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">TSUM1</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>        <span class="n">safe_den</span> <span class="o">=</span> <span class="n">safe_den</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">safe_den</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>        <span class="n">dvr_vegetative</span> <span class="o">=</span> <span class="n">dtsum_vegetative</span> <span class="o">/</span> <span class="n">safe_den</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>        <span class="n">r</span><span class="o">.</span><span class="n">DTSUM</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_vegetative</span><span class="p">,</span> <span class="n">dtsum_vegetative</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">DTSUM</span><span class="p">)</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>        <span class="n">r</span><span class="o">.</span><span class="n">DVR</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_vegetative</span><span class="p">,</span> <span class="n">dvr_vegetative</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">DVR</span><span class="p">)</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>    <span class="c1"># Compute rates for reproductive stage (STAGE == 2)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>    <span class="n">is_reproductive</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">is_reproductive</span><span class="p">):</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="n">dtsum_reproductive</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">DTSMTB</span><span class="p">(</span><span class="n">TEMP</span><span class="p">)</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>        <span class="n">safe_den</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">TSUM2</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="n">safe_den</span> <span class="o">=</span> <span class="n">safe_den</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">safe_den</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">)</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>        <span class="n">dvr_reproductive</span> <span class="o">=</span> <span class="n">dtsum_reproductive</span> <span class="o">/</span> <span class="n">safe_den</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>        <span class="n">r</span><span class="o">.</span><span class="n">DTSUM</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_reproductive</span><span class="p">,</span> <span class="n">dtsum_reproductive</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">DTSUM</span><span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span class="n">r</span><span class="o">.</span><span class="n">DVR</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_reproductive</span><span class="p">,</span> <span class="n">dvr_reproductive</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">DVR</span><span class="p">)</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>    <span class="c1"># Mature stage (STAGE == 3) keeps zeros (already initialized)</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Finished rate calculation for </span><span class="si">%s</span><span class="s2">&quot;</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">day</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.phenology.DVS_Phenology.integrate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">integrate</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">integrate</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">delt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Integrate phenology states and manage stage transitions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>day</code></b>
              (<code><span title="datetime.date">date</span></code>)
          –
          <div class="doc-md-description">
            <p>Current simulation day.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>delt</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>Timestep length in days (default 1.0).</p>
          </div>
        </li>
    </ul>


<details class="sequence" open>
  <summary>Sequence</summary>
  <ul>
<li>Integrates vernalisation module if active and in vegetative stage.</li>
<li>Accumulates TSUME, TSUM, advances DVS by DVR.</li>
<li>Checks threshold crossings to move through stages:
    emerging -&gt; vegetative (DVS &gt;= 0)
    vegetative -&gt; reproductive (DVS &gt;= 1)
    reproductive -&gt; mature (DVS &gt;= DVSEND)</li>
</ul>
</details>

<details class="side-effects" open>
  <summary>Side Effects</summary>
  <ul>
<li>Emits crop_emerged signal on emergence.</li>
<li>Emits crop_finish signal at maturity if end type matches.</li>
</ul>
</details>

<details class="notes" open>
  <summary>Notes</summary>
  <p>Caps DVS at stage boundary values.</p>
</details>

<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="PCSEError">PCSEError</span></code>
            –
          <div class="doc-md-description">
            <p>If STAGE undefined.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/phenology.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="nd">@prepare_states</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="k">def</span><span class="w"> </span><span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">delt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrate phenology states and manage stage transitions.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">        day (datetime.date): Current simulation day.</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a><span class="sd">        delt (float, optional): Timestep length in days (default 1.0).</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">    Sequence:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">        - Integrates vernalisation module if active and in vegetative stage.</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        - Accumulates TSUME, TSUM, advances DVS by DVR.</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">        - Checks threshold crossings to move through stages:</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">            emerging -&gt; vegetative (DVS &gt;= 0)</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">            vegetative -&gt; reproductive (DVS &gt;= 1)</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">            reproductive -&gt; mature (DVS &gt;= DVSEND)</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">    Side Effects:</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">        - Emits crop_emerged signal on emergence.</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">        - Emits crop_finish signal at maturity if end type matches.</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="sd">    Notes:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">        Caps DVS at stage boundary values.</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="sd">        PCSEError: If STAGE undefined.</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>    <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>    <span class="c1"># Integrate vernalisation module</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="c1"># Save a copy of state</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>        <span class="n">state_copy</span> <span class="o">=</span> <span class="n">_snapshot_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="n">mask_IDSL</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">IDSL</span> <span class="o">&gt;=</span> <span class="mi">2</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>        <span class="c1"># Check if any element is in vegetative stage i.e. stage 1</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>        <span class="n">mask_STAGE</span> <span class="o">=</span> <span class="n">mask_IDSL</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">delt</span><span class="p">)</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>        <span class="n">state_integrated</span> <span class="o">=</span> <span class="n">_snapshot_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>        <span class="c1"># Restore original state</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>        <span class="n">_restore_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="n">state_copy</span><span class="p">)</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>        <span class="n">state_touched</span> <span class="o">=</span> <span class="n">_snapshot_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="c1"># Apply the masks</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">state_copy</span><span class="p">:</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>            <span class="c1"># results of vernalisation module</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>            <span class="n">vernalisation_states</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                <span class="n">mask_STAGE</span><span class="p">,</span> <span class="n">state_integrated</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">state_touched</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>            <span class="p">)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>            <span class="nb">setattr</span><span class="p">(</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vernalisation</span><span class="o">.</span><span class="n">states</span><span class="p">,</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>                <span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>                <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_IDSL</span><span class="p">,</span> <span class="n">vernalisation_states</span><span class="p">,</span> <span class="n">state_copy</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>            <span class="p">)</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>    <span class="c1"># Integrate phenologic states</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>    <span class="n">s</span><span class="o">.</span><span class="n">TSUME</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">TSUME</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">DTSUME</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>    <span class="n">s</span><span class="o">.</span><span class="n">DVS</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">DVS</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">DVR</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>    <span class="n">s</span><span class="o">.</span><span class="n">TSUM</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">TSUM</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">DTSUM</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>    <span class="n">day_ordinal</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">day</span><span class="o">.</span><span class="n">toordinal</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>    <span class="c1"># Check transitions for emerging -&gt; vegetative (STAGE 0 -&gt; 1)</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>    <span class="n">is_emerging</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>    <span class="n">should_emerge</span> <span class="o">=</span> <span class="n">is_emerging</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">DVS</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>    <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="n">should_emerge</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>    <span class="p">)</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>    <span class="n">s</span><span class="o">.</span><span class="n">DOE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="n">should_emerge</span><span class="p">,</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">day_ordinal</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>        <span class="n">s</span><span class="o">.</span><span class="n">DOE</span><span class="p">,</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>    <span class="p">)</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>    <span class="n">s</span><span class="o">.</span><span class="n">DVS</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">should_emerge</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">DVS</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">DVS</span><span class="p">)</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>    <span class="c1"># Send signal if any crop emerged (only once per day)</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">should_emerge</span><span class="p">):</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_send_signal</span><span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">crop_emerged</span><span class="p">)</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>    <span class="c1"># Check transitions for vegetative -&gt; reproductive (STAGE 1 -&gt; 2)</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>    <span class="n">is_vegetative</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>    <span class="n">should_flower</span> <span class="o">=</span> <span class="n">is_vegetative</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">DVS</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>    <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>        <span class="n">should_flower</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>    <span class="p">)</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>    <span class="n">s</span><span class="o">.</span><span class="n">DOA</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>        <span class="n">should_flower</span><span class="p">,</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">day_ordinal</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>        <span class="n">s</span><span class="o">.</span><span class="n">DOA</span><span class="p">,</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>    <span class="p">)</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>    <span class="n">s</span><span class="o">.</span><span class="n">DVS</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">should_flower</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">DVS</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">DVS</span><span class="p">)</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>    <span class="c1"># Check transitions for reproductive -&gt; mature (STAGE 2 -&gt; 3)</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>    <span class="n">is_reproductive</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>    <span class="n">should_mature</span> <span class="o">=</span> <span class="n">is_reproductive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">DVS</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">DVSEND</span><span class="p">)</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>    <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>        <span class="n">should_mature</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">STAGE</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>    <span class="p">)</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>    <span class="n">s</span><span class="o">.</span><span class="n">DOM</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>        <span class="n">should_mature</span><span class="p">,</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">day_ordinal</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="n">s</span><span class="o">.</span><span class="n">DOM</span><span class="p">,</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>    <span class="p">)</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>    <span class="n">s</span><span class="o">.</span><span class="n">DVS</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">should_mature</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">DVS</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">DVSEND</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">DVS</span><span class="p">)</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>    <span class="c1"># Send crop_finish signal if maturity reached for one.</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>    <span class="c1"># assumption is that all elements mature simultaneously</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>    <span class="c1"># TODO: revisit this when fixing engine for agromanager</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">should_mature</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">CROP_END_TYPE</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;maturity&quot;</span><span class="p">,</span> <span class="s2">&quot;earliest&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_send_signal</span><span class="p">(</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>            <span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">crop_finish</span><span class="p">,</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>            <span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>            <span class="n">finish_type</span><span class="o">=</span><span class="s2">&quot;maturity&quot;</span><span class="p">,</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>            <span class="n">crop_delete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>        <span class="p">)</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Finished state integration for </span><span class="si">%s</span><span class="s2">&quot;</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">day</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.phenology.DVS_Phenology.get_variable" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_variable</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_variable</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the value of the specified state or rate variable.</p>
<p>:param varname: Name of the variable.</p>
<p>Note that the <code>get_variable()</code> will searches for <code>varname</code> exactly
as specified (case sensitive).</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/phenology.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="p">):</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>    <span class="c1"># TODO: should be removed while fixing #49. this is needed because</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>    <span class="c1"># conditions are applied on STAGE in pcse.crop.wofost72.py</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the value of the specified state or rate variable.</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a><span class="sd">    :param varname: Name of the variable.</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="sd">    Note that the `get_variable()` will searches for `varname` exactly</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="sd">    as specified (case sensitive).</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>    <span class="k">if</span> <span class="n">varname</span> <span class="o">==</span> <span class="s2">&quot;STAGE&quot;</span><span class="p">:</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>        <span class="c1"># Return string representation of current stage</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="n">stage_map</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>            <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;emerging&quot;</span><span class="p">,</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>            <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;vegetative&quot;</span><span class="p">,</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>            <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;reproductive&quot;</span><span class="p">,</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>            <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;mature&quot;</span><span class="p">,</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>        <span class="p">}</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="n">stage_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">STAGE</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="k">if</span> <span class="n">stage_value</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>            <span class="n">stage_id</span> <span class="o">=</span> <span class="n">stage_value</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="n">stage_id</span> <span class="o">=</span> <span class="n">stage_value</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>        <span class="k">return</span> <span class="n">stage_map</span><span class="p">[</span><span class="n">stage_id</span><span class="p">]</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>    <span class="c1"># Search for variable in the current object, then traverse the hierarchy</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>    <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="n">varname</span><span class="p">):</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="n">varname</span><span class="p">)</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">,</span> <span class="n">varname</span><span class="p">):</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">,</span> <span class="n">varname</span><span class="p">)</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>    <span class="c1"># Query individual sub-SimObject for existence of variable v</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>        <span class="k">for</span> <span class="n">simobj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subSimObjects</span><span class="p">:</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">simobj</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>                <span class="k">break</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="diffwofost.physical_models.crop.partitioning.DVS_Partitioning" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">diffwofost.physical_models.crop.partitioning.DVS_Partitioning</span>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="diffwofost.physical_models.crop.partitioning._BaseDVSPartitioning">_BaseDVSPartitioning</span></code></p>



        <p>Class for assimilate partitioning based on development stage (DVS).</p>
<p><code>DVS_Partitioning</code> calculates the partitioning of the assimilates to roots,
stems, leaves and storage organs using fixed partitioning tables as a
function of crop development stage. The available assimilates are first
split into below-ground and aboveground using the values in FRTB. In a
second stage they are split into leaves (FLTB), stems (FSTB) and storage
organs (FOTB).</p>
<p>Since the partitioning fractions are derived from the state variable DVS
they are regarded state variables as well.</p>
<p><strong>Simulation parameters</strong> (To be provided in cropdata dictionary):</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>FRTB</td>
<td>Partitioning to roots as a function of development stage</td>
<td>TCr</td>
<td>-</td>
</tr>
<tr>
<td>FSTB</td>
<td>Partitioning to stems as a function of development stage</td>
<td>TCr</td>
<td>-</td>
</tr>
<tr>
<td>FLTB</td>
<td>Partitioning to leaves as a function of development stage</td>
<td>TCr</td>
<td>-</td>
</tr>
<tr>
<td>FOTB</td>
<td>Partitioning to storage organs as a function of development  stage</td>
<td>TCr</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>State variables</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>FR</td>
<td>Fraction partitioned to roots</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>FS</td>
<td>Fraction partitioned to stems</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>FL</td>
<td>Fraction partitioned to leaves</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>FO</td>
<td>Fraction partitioned to storage organs</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>PF</td>
<td>Partitioning factors packed in tuple</td>
<td>N</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Rate variables</strong></p>
<p>None</p>
<p><strong>External dependencies:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Provided by</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>DVS</td>
<td>Crop development stage</td>
<td>DVS_Phenology</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Outputs</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>FR</td>
<td>Fraction partitioned to roots</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>FL</td>
<td>Fraction partitioned to leaves</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>FS</td>
<td>Fraction partitioned to stems</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>FO</td>
<td>Fraction partitioned to storage organs</td>
<td>Y</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Gradient mapping (which parameters have a gradient):</strong></p>
<table>
<thead>
<tr>
<th>Output</th>
<th>Parameters influencing it</th>
</tr>
</thead>
<tbody>
<tr>
<td>FR</td>
<td>FRTB, DVS</td>
</tr>
<tr>
<td>FL</td>
<td>FLTB, DVS</td>
</tr>
<tr>
<td>FS</td>
<td>FSTB, DVS</td>
</tr>
<tr>
<td>FO</td>
<td>FOTB, DVS</td>
</tr>
</tbody>
</table>
<p><em>Exceptions raised</em></p>
<p>A PartitioningError is raised if the partitioning coefficients to leaves,
stems and storage organs on a given day do not add up to 1.</p>

          











<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            initialize (diffwofost.physical_models.crop.partitioning.DVS_Partitioning.initialize)" href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning.initialize">initialize</a></code></b>
            –
            <div class="doc-md-description">
              <p>Initialize the DVS_Partitioning simulation object.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            integrate (diffwofost.physical_models.crop.partitioning.DVS_Partitioning.integrate)" href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning.integrate">integrate</a></code></b>
            –
            <div class="doc-md-description">
              <p>Update partitioning factors based on development stage (DVS).</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            calc_rates (diffwofost.physical_models.crop.partitioning.DVS_Partitioning.calc_rates)" href="#diffwofost.physical_models.crop.partitioning.DVS_Partitioning.calc_rates">calc_rates</a></code></b>
            –
            <div class="doc-md-description">
              <p>Return partitioning factors based on current DVS.</p>
            </div>
          </li>
    </ul>






<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.partitioning.DVS_Partitioning.initialize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">initialize</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">initialize</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">kiosk</span><span class="p">,</span> <span class="n">parvalues</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the DVS_Partitioning simulation object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>day</code></b>
          –
          <div class="doc-md-description">
            <p>Start date of the simulation.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>kiosk</code></b>
              (<code><span title="VariableKiosk">VariableKiosk</span></code>)
          –
          <div class="doc-md-description">
            <p>Variable kiosk of this PCSE instance.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>parvalues</code></b>
              (<code><span title="ParameterProvider">ParameterProvider</span></code>)
          –
          <div class="doc-md-description">
            <p>Object providing parameters as
key/value pairs.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/partitioning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">kiosk</span><span class="p">,</span> <span class="n">parvalues</span><span class="p">):</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the DVS_Partitioning simulation object.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        day: Start date of the simulation.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        kiosk (VariableKiosk): Variable kiosk of this PCSE instance.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        parvalues (ParameterProvider): Object providing parameters as</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">            key/value pairs.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_from_tables</span><span class="p">(</span><span class="n">kiosk</span><span class="p">,</span> <span class="n">parvalues</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.partitioning.DVS_Partitioning.integrate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">integrate</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">integrate</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">delt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Update partitioning factors based on development stage (DVS).</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/partitioning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="nd">@prepare_states</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="k">def</span><span class="w"> </span><span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">delt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Update partitioning factors based on development stage (DVS).&quot;&quot;&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_update_from_tables</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.partitioning.DVS_Partitioning.calc_rates" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calc_rates</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calc_rates</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">drv</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return partitioning factors based on current DVS.</p>
<p>Rate calculation does nothing for partitioning as it is a derived state.</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/partitioning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">drv</span><span class="p">):</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return partitioning factors based on current DVS.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    Rate calculation does nothing for partitioning as it is a derived state.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">PF</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation</span>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pcse.base.SimulationObject">SimulationObject</span></code></p>



        <p>Class implementing a WOFOST/SUCROS style assimilation routine.</p>
<p>WOFOST calculates the daily gross CO2 assimilation rate of a crop
from the absorbed radiation and the photosynthesis-light response curve
of individual leaves. This response is dependent on temperature and
leaf age. The absorbed radiation is calculated from the total incoming
radiation and the leaf area. Daily gross CO2 assimilation is obtained
by integrating the assimilation rates over the leaf layers and over the
day.</p>
<p><strong>Simulation parameters</strong> (provide in cropdata dictionary)</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>AMAXTB</td>
<td>Max. leaf CO2 assimilation rate as function of DVS</td>
<td>TCr</td>
<td>kg CO2 ha⁻¹ leaf h⁻¹</td>
</tr>
<tr>
<td>EFFTB</td>
<td>Light use effic. single leaf as a function of daily mean temperature</td>
<td>TCr</td>
<td>kg CO2 ha⁻¹ h⁻¹ /(J m⁻² s⁻¹)</td>
</tr>
<tr>
<td>KDIFTB</td>
<td>Extinction coefficient for diffuse visible light as function of DVS</td>
<td>TCr</td>
<td>-</td>
</tr>
<tr>
<td>TMPFTB</td>
<td>Reduction factor on AMAX as function of daily mean temperature</td>
<td>TCr</td>
<td>-</td>
</tr>
<tr>
<td>TMNFTB</td>
<td>Reduction factor on AMAX as function of daily minimum temperature</td>
<td>TCr</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Rate variables</strong>
This class returns the potential gross assimilation rate 'PGASS'
directly from the <code>__call__()</code> method, but also includes it as a rate variable.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>PGASS</td>
<td>Potential gross assimilation</td>
<td>Y</td>
<td>kg CH2O ha⁻¹ d⁻¹</td>
</tr>
</tbody>
</table>
<p><strong>External dependencies</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Provided by</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>DVS</td>
<td>Crop development stage</td>
<td>DVS_Phenology</td>
<td>-</td>
</tr>
<tr>
<td>LAI</td>
<td>Leaf area index</td>
<td>Leaf_dynamics</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Weather inputs used</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>IRRAD</td>
<td>Daily shortwave radiation</td>
<td>J m⁻² d⁻¹</td>
</tr>
<tr>
<td>DTEMP</td>
<td>Daily mean temperature</td>
<td>°C</td>
</tr>
<tr>
<td>TMIN</td>
<td>Daily minimum temperature</td>
<td>°C</td>
</tr>
<tr>
<td>LAT</td>
<td>Latitude</td>
<td>degrees</td>
</tr>
</tbody>
</table>
<p><strong>Outputs</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>PGASS</td>
<td>Potential gross assimilation</td>
<td>Y</td>
<td>kg CH2O ha⁻¹ d⁻¹</td>
</tr>
</tbody>
</table>
<p><strong>Gradient mapping (which parameters have a gradient):</strong></p>
<table>
<thead>
<tr>
<th>Output</th>
<th>Parameters influencing it</th>
</tr>
</thead>
<tbody>
<tr>
<td>PGASS</td>
<td>AMAXTB, EFFTB, KDIFTB, TMPFTB, TMNFTB</td>
</tr>
</tbody>
</table>

          











<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            initialize (diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.initialize)" href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.initialize">initialize</a></code></b>
            –
            <div class="doc-md-description">
              <p>Initialize the assimilation module.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            calc_rates (diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.calc_rates)" href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.calc_rates">calc_rates</a></code></b>
            –
            <div class="doc-md-description">
              <p>Compute the potential gross assimilation rate (PGASS).</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            __call__ (diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.__call__)" href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.__call__">__call__</a></code></b>
            –
            <div class="doc-md-description">
              <p>Calculate and return the potential gross assimilation rate (PGASS).</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            integrate (diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.integrate)" href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.integrate">integrate</a></code></b>
            –
            <div class="doc-md-description">
              <p>No state variables to integrate for this module.</p>
            </div>
          </li>
    </ul>




<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            device


  
      property
   (diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.device)" href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.device">device</a></code></b>
          –
          <div class="doc-md-description">
            <p>Get device from ComputeConfig.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            dtype


  
      property
   (diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.dtype)" href="#diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.dtype">dtype</a></code></b>
          –
          <div class="doc-md-description">
            <p>Get dtype from ComputeConfig.</p>
          </div>
        </li>
    </ul>




<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.device" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">device</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">device</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get device from ComputeConfig.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.dtype" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">dtype</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">dtype</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get dtype from ComputeConfig.</p>

          
    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.initialize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">initialize</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">initialize</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n"><span title="datetime.date">date</span></span><span class="p">,</span> <span class="n">kiosk</span><span class="p">:</span> <span class="n"><span title="pcse.base.variablekiosk.VariableKiosk">VariableKiosk</span></span><span class="p">,</span> <span class="n">parvalues</span><span class="p">:</span> <span class="n"><span title="pcse.base.parameter_providers.ParameterProvider">ParameterProvider</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the assimilation module.</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/assimilation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">kiosk</span><span class="p">:</span> <span class="n">VariableKiosk</span><span class="p">,</span> <span class="n">parvalues</span><span class="p">:</span> <span class="n">ParameterProvider</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the assimilation module.&quot;&quot;&quot;</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span> <span class="o">=</span> <span class="n">kiosk</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Parameters</span><span class="p">(</span><span class="n">parvalues</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span> <span class="o">=</span> <span class="n">_get_params_shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RateVariables</span><span class="p">(</span><span class="n">kiosk</span><span class="p">,</span> <span class="n">publish</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PGASS&quot;</span><span class="p">])</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="c1"># 7-day running average buffer for TMIN (stored as tensors).</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_tmn_window</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_tmn_window_mask</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="c1"># Reused scalar constants</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.calc_rates" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calc_rates</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calc_rates</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n"><span title="datetime.date">date</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">drv</span><span class="p">:</span> <span class="n"><span title="pcse.base.weather.WeatherDataContainer">WeatherDataContainer</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the potential gross assimilation rate (PGASS).</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/assimilation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="nd">@prepare_rates</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">drv</span><span class="p">:</span> <span class="n">WeatherDataContainer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the potential gross assimilation rate (PGASS).&quot;&quot;&quot;</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="n">_exist_required_external_variables</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="c1"># External states</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="n">dvs</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s2">&quot;DVS&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="n">lai</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="c1"># Weather drivers</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="n">irrad</span> <span class="o">=</span> <span class="n">_get_drv</span><span class="p">(</span><span class="n">drv</span><span class="o">.</span><span class="n">IRRAD</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">dtemp</span> <span class="o">=</span> <span class="n">_get_drv</span><span class="p">(</span><span class="n">drv</span><span class="o">.</span><span class="n">DTEMP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="n">tmin</span> <span class="o">=</span> <span class="n">_get_drv</span><span class="p">(</span><span class="n">drv</span><span class="o">.</span><span class="n">TMIN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="c1"># Assimilation is zero before crop emergence (DVS &lt; 0)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="n">dvs_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">dvs</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="c1"># 7-day running average of TMIN</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_tmn_window</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">tmin</span> <span class="o">*</span> <span class="n">dvs_mask</span><span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_tmn_window_mask</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">dvs_mask</span><span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="n">tmin_stack</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tmn_window</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="n">mask_stack</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tmn_window_mask</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="n">tminra</span> <span class="o">=</span> <span class="n">tmin_stack</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mask_stack</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="c1"># Astronomical variables (computed with PCSE util; then broadcast to tensors)</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="n">lat</span> <span class="o">=</span> <span class="n">_as_python_float</span><span class="p">(</span><span class="n">drv</span><span class="o">.</span><span class="n">LAT</span><span class="p">)</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="n">irrad_for_astro</span> <span class="o">=</span> <span class="n">_as_python_float</span><span class="p">(</span><span class="n">drv</span><span class="o">.</span><span class="n">IRRAD</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="n">dayl</span><span class="p">,</span> <span class="n">_daylp</span><span class="p">,</span> <span class="n">sinld</span><span class="p">,</span> <span class="n">cosld</span><span class="p">,</span> <span class="n">difpp</span><span class="p">,</span> <span class="n">_atmtr</span><span class="p">,</span> <span class="n">dsinbe</span><span class="p">,</span> <span class="n">_angot</span> <span class="o">=</span> <span class="n">astro</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">irrad_for_astro</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="n">dayl_t</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">dayl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">sinld_t</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">sinld</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="n">cosld_t</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">cosld</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="n">difpp_t</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">difpp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="n">dsinbe_t</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">dsinbe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="c1"># Parameter tables</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="n">amax</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">AMAXTB</span><span class="p">(</span><span class="n">dvs</span><span class="p">)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="n">amax</span> <span class="o">=</span> <span class="n">amax</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">TMPFTB</span><span class="p">(</span><span class="n">dtemp</span><span class="p">)</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">kdif</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">KDIFTB</span><span class="p">(</span><span class="n">dvs</span><span class="p">)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">eff</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">EFFTB</span><span class="p">(</span><span class="n">dtemp</span><span class="p">)</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="n">dtga</span> <span class="o">=</span> <span class="n">totass7</span><span class="p">(</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">dayl_t</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">amax</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="n">eff</span><span class="p">,</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="n">lai</span><span class="p">,</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="n">kdif</span><span class="p">,</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="n">irrad</span><span class="p">,</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="n">difpp_t</span><span class="p">,</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="n">dsinbe_t</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="n">sinld_t</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">cosld_t</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="n">epsilon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">,</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="c1"># Correction for low minimum temperature potential</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="n">dtga</span> <span class="o">=</span> <span class="n">dtga</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">TMNFTB</span><span class="p">(</span><span class="n">tminra</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="c1"># Convert kg CO2 -&gt; kg CH2O</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="n">pgass</span> <span class="o">=</span> <span class="n">dtga</span> <span class="o">*</span> <span class="p">(</span><span class="mf">30.0</span> <span class="o">/</span> <span class="mf">44.0</span><span class="p">)</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="c1"># Assimilation is zero before crop emergence (DVS &lt; 0)</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">r</span><span class="o">.</span><span class="n">PGASS</span> <span class="o">=</span> <span class="n">pgass</span> <span class="o">*</span> <span class="n">dvs_mask</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">PGASS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.__call__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__call__</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">__call__</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n"><span title="datetime.date">date</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">drv</span><span class="p">:</span> <span class="n"><span title="pcse.base.weather.WeatherDataContainer">WeatherDataContainer</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate and return the potential gross assimilation rate (PGASS).</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/assimilation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">drv</span><span class="p">:</span> <span class="n">WeatherDataContainer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return the potential gross assimilation rate (PGASS).&quot;&quot;&quot;</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_rates</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">drv</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.assimilation.WOFOST72_Assimilation.integrate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">integrate</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">integrate</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n"><span title="datetime.date">date</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">delt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>No state variables to integrate for this module.</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/assimilation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="nd">@prepare_states</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="k">def</span><span class="w"> </span><span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">delt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;No state variables to integrate for this module.&quot;&quot;&quot;</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics</span>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pcse.base.SimulationObject">SimulationObject</span></code></p>



        <p>Leaf dynamics for the WOFOST crop model.</p>
<p>Implementation of biomass partitioning to leaves, growth and senenscence
of leaves. WOFOST keeps track of the biomass that has been partitioned to
the leaves for each day (variable <code>LV</code>), which is called a leaf class).
For each leaf class the leaf age (variable 'LVAGE') and specific leaf area
(variable <code>SLA</code>) are also registered. Total living leaf biomass is
calculated by summing the biomass values for all leaf classes. Similarly,
leaf area is calculated by summing leaf biomass times specific leaf area
(<code>LV</code> * <code>SLA</code>).</p>
<p>Senescense of the leaves can occur as a result of physiological age,
drought stress or self-shading.</p>
<p><strong>Simulation parameters</strong> (provide in cropdata dictionary)</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>RGRLAI</td>
<td>Maximum relative increase in LAI.</td>
<td>SCr</td>
<td>ha ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>SPAN</td>
<td>Life span of leaves growing at 35 Celsius</td>
<td>SCr</td>
<td>d</td>
</tr>
<tr>
<td>TBASE</td>
<td>Lower threshold temp. for ageing of leaves</td>
<td>SCr</td>
<td>C</td>
</tr>
<tr>
<td>PERDL</td>
<td>Max. relative death rate of leaves due to water stress</td>
<td>SCr</td>
<td></td>
</tr>
<tr>
<td>TDWI</td>
<td>Initial total crop dry weight</td>
<td>SCr</td>
<td>kg ha⁻¹</td>
</tr>
<tr>
<td>KDIFTB</td>
<td>Extinction coefficient for diffuse visible light as function of DVS</td>
<td>TCr</td>
<td></td>
</tr>
<tr>
<td>SLATB</td>
<td>Specific leaf area as a function of DVS</td>
<td>TCr</td>
<td>ha kg⁻¹</td>
</tr>
</tbody>
</table>
<p><strong>State variables</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>LV</td>
<td>Leaf biomass per leaf class</td>
<td>N</td>
<td>kg ha⁻¹</td>
</tr>
<tr>
<td>SLA</td>
<td>Specific leaf area per leaf class</td>
<td>N</td>
<td>ha kg⁻¹</td>
</tr>
<tr>
<td>LVAGE</td>
<td>Leaf age per leaf class</td>
<td>N</td>
<td>d</td>
</tr>
<tr>
<td>LVSUM</td>
<td>Sum of LV</td>
<td>N</td>
<td>kg ha⁻¹</td>
</tr>
<tr>
<td>LAIEM</td>
<td>LAI at emergence</td>
<td>N</td>
<td>-</td>
</tr>
<tr>
<td>LASUM</td>
<td>Total leaf area as sum of LV*SLA, not including stem and pod area</td>
<td>N</td>
<td>-</td>
</tr>
<tr>
<td>LAIEXP</td>
<td>LAI value under theoretical exponential growth</td>
<td>N</td>
<td>-</td>
</tr>
<tr>
<td>LAIMAX</td>
<td>Maximum LAI reached during growth cycle</td>
<td>N</td>
<td>-</td>
</tr>
<tr>
<td>LAI</td>
<td>Leaf area index, including stem and pod area</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>WLV</td>
<td>Dry weight of living leaves</td>
<td>Y</td>
<td>kg ha⁻¹</td>
</tr>
<tr>
<td>DWLV</td>
<td>Dry weight of dead leaves</td>
<td>N</td>
<td>kg ha⁻¹</td>
</tr>
<tr>
<td>TWLV</td>
<td>Dry weight of total leaves (living + dead)</td>
<td>Y</td>
<td>kg ha⁻¹</td>
</tr>
</tbody>
</table>
<p><strong>Rate variables</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>GRLV</td>
<td>Growth rate leaves</td>
<td>N</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>DSLV1</td>
<td>Death rate leaves due to water stress</td>
<td>N</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>DSLV2</td>
<td>Death rate leaves due to self-shading</td>
<td>N</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>DSLV3</td>
<td>Death rate leaves due to frost kill</td>
<td>N</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>DSLV</td>
<td>Maximum of DSLV1, DSLV2, DSLV3</td>
<td>N</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>DALV</td>
<td>Death rate leaves due to aging</td>
<td>N</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>DRLV</td>
<td>Death rate leaves as a combination of DSLV and DALV</td>
<td>N</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>SLAT</td>
<td>Specific leaf area for current time step, adjusted for source/sink limited leaf expansion rate</td>
<td>N</td>
<td>ha kg⁻¹</td>
</tr>
<tr>
<td>FYSAGE</td>
<td>Increase in physiological leaf age</td>
<td>N</td>
<td>-</td>
</tr>
<tr>
<td>GLAIEX</td>
<td>Sink-limited leaf expansion rate (exponential curve)</td>
<td>N</td>
<td>ha ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>GLASOL</td>
<td>Source-limited leaf expansion rate (biomass increase)</td>
<td>N</td>
<td>ha ha⁻¹ d⁻¹</td>
</tr>
</tbody>
</table>
<p><strong>External dependencies</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Provided by</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>DVS</td>
<td>Crop development stage</td>
<td>DVS_Phenology</td>
<td>-</td>
</tr>
<tr>
<td>FL</td>
<td>Fraction biomass to leaves</td>
<td>DVS_Partitioning</td>
<td>-</td>
</tr>
<tr>
<td>FR</td>
<td>Fraction biomass to roots</td>
<td>DVS_Partitioning</td>
<td>-</td>
</tr>
<tr>
<td>SAI</td>
<td>Stem area index</td>
<td>WOFOST_Stem_Dynamics</td>
<td>-</td>
</tr>
<tr>
<td>PAI</td>
<td>Pod area index</td>
<td>WOFOST_Storage_Organ_Dynamics</td>
<td>-</td>
</tr>
<tr>
<td>TRA</td>
<td>Transpiration rate</td>
<td>Evapotranspiration</td>
<td>cm day⁻¹ ?</td>
</tr>
<tr>
<td>TRAMX</td>
<td>Maximum transpiration rate</td>
<td>Evapotranspiration</td>
<td>cm day⁻¹ ?</td>
</tr>
<tr>
<td>ADMI</td>
<td>Above-ground dry matter increase</td>
<td>CropSimulation</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>RFTRA</td>
<td>Reduction factor for transpiration (water &amp; oxygen)</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>RF_FROST</td>
<td>Reduction factor frost kill</td>
<td>FROSTOL (optional)</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Outputs</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>LAI</td>
<td>Leaf area index, including stem and pod area</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>TWLV</td>
<td>Dry weight of total leaves (living + dead)</td>
<td>Y</td>
<td>kg ha⁻¹</td>
</tr>
</tbody>
</table>
<p><strong>Gradient mapping (which parameters have a gradient):</strong></p>
<table>
<thead>
<tr>
<th>Output</th>
<th>Parameters influencing it</th>
</tr>
</thead>
<tbody>
<tr>
<td>LAI</td>
<td>TDWI, SPAN, RGRLAI, TBASE, KDIFTB, SLATB</td>
</tr>
<tr>
<td>TWLV</td>
<td>TDWI, PERDL</td>
</tr>
</tbody>
</table>
<p>[!NOTE]
Notice that the following gradients are zero:
    - ∂SPAN/∂TWLV
    - ∂PERDL/∂TWLV
    - ∂KDIFTB/∂LAI</p>

          











<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            initialize (diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.initialize)" href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.initialize">initialize</a></code></b>
            –
            <div class="doc-md-description">
              <p>Initialize the WOFOST_Leaf_Dynamics simulation object.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            calc_rates (diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.calc_rates)" href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.calc_rates">calc_rates</a></code></b>
            –
            <div class="doc-md-description">
              <p>Calculate the rates of change for the leaf dynamics.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            integrate (diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.integrate)" href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.integrate">integrate</a></code></b>
            –
            <div class="doc-md-description">
              <p>Integrate the leaf dynamics state variables.</p>
            </div>
          </li>
    </ul>




<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            device


  
      property
   (diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.device)" href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.device">device</a></code></b>
          –
          <div class="doc-md-description">
            <p>Get device from ComputeConfig.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            dtype


  
      property
   (diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.dtype)" href="#diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.dtype">dtype</a></code></b>
          –
          <div class="doc-md-description">
            <p>Get dtype from ComputeConfig.</p>
          </div>
        </li>
    </ul>




<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.device" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">device</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">device</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get device from ComputeConfig.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.dtype" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">dtype</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">dtype</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get dtype from ComputeConfig.</p>

          
    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.initialize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">initialize</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">initialize</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n"><span title="datetime.date">date</span></span><span class="p">,</span> <span class="n">kiosk</span><span class="p">:</span> <span class="n"><span title="pcse.base.variablekiosk.VariableKiosk">VariableKiosk</span></span><span class="p">,</span> <span class="n">parvalues</span><span class="p">:</span> <span class="n"><span title="pcse.base.parameter_providers.ParameterProvider">ParameterProvider</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the WOFOST_Leaf_Dynamics simulation object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>day</code></b>
              (<code><span title="datetime.date">date</span></code>)
          –
          <div class="doc-md-description">
            <p>The starting date of the simulation.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>kiosk</code></b>
              (<code><span title="pcse.base.variablekiosk.VariableKiosk">VariableKiosk</span></code>)
          –
          <div class="doc-md-description">
            <p>A container for registering and publishing
(internal and external) state variables. See PCSE documentation for
details.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>parvalues</code></b>
              (<code><span title="pcse.base.parameter_providers.ParameterProvider">ParameterProvider</span></code>)
          –
          <div class="doc-md-description">
            <p>A dictionary-like container holding
all parameter sets (crop, soil, site) as key/value. The values are
arrays or scalars. See PCSE documentation for details.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/leaf_dynamics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">kiosk</span><span class="p">:</span> <span class="n">VariableKiosk</span><span class="p">,</span> <span class="n">parvalues</span><span class="p">:</span> <span class="n">ParameterProvider</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the WOFOST_Leaf_Dynamics simulation object.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        day (datetime.date): The starting date of the simulation.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        kiosk (VariableKiosk): A container for registering and publishing</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">            (internal and external) state variables. See PCSE documentation for</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">            details.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        parvalues (ParameterProvider): A dictionary-like container holding</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">            all parameter sets (crop, soil, site) as key/value. The values are</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">            arrays or scalars. See PCSE documentation for details.</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">START_DATE</span> <span class="o">=</span> <span class="n">day</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span> <span class="o">=</span> <span class="n">kiosk</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="c1"># TODO check if parvalues are already torch.nn.Parameters</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Parameters</span><span class="p">(</span><span class="n">parvalues</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RateVariables</span><span class="p">(</span><span class="n">kiosk</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="c1"># Create scalar constants once at the beginning to avoid recreating them</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_zero</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_sigmoid_sharpness</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_sigmoid_epsilon</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">1e-14</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="c1"># CALCULATE INITIAL STATE VARIABLES</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="c1"># check for required external variables</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="n">_exist_required_external_variables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="c1"># TODO check if external variables are already torch tensors</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="c1"># Get kiosk values and ensure they are on the correct device</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="n">FL</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">[</span><span class="s2">&quot;FL&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="n">FR</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">[</span><span class="s2">&quot;FR&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">DVS</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">[</span><span class="s2">&quot;DVS&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span> <span class="o">=</span> <span class="n">_get_params_shape</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="c1"># Initial leaf biomass</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="n">TDWI</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">TDWI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="n">WLV</span> <span class="o">=</span> <span class="p">(</span><span class="n">TDWI</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">FR</span><span class="p">))</span> <span class="o">*</span> <span class="n">FL</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">DWLV</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="n">TWLV</span> <span class="o">=</span> <span class="n">WLV</span> <span class="o">+</span> <span class="n">DWLV</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="c1"># Initialize leaf classes (SLA, age and weight)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="n">SLA</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_DAYS</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="n">LVAGE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_DAYS</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="n">LV</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_DAYS</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="n">SLA</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">SLATB</span><span class="p">(</span><span class="n">DVS</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="n">LV</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">WLV</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="c1"># Initial values for leaf area</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="n">LAIEM</span> <span class="o">=</span> <span class="n">LV</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">SLA</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">LASUM</span> <span class="o">=</span> <span class="n">LAIEM</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="n">LAIEXP</span> <span class="o">=</span> <span class="n">LAIEM</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="n">LAIMAX</span> <span class="o">=</span> <span class="n">LAIEM</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="n">SAI</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">[</span><span class="s2">&quot;SAI&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="n">PAI</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">[</span><span class="s2">&quot;PAI&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="n">LAI</span> <span class="o">=</span> <span class="n">LASUM</span> <span class="o">+</span> <span class="n">SAI</span> <span class="o">+</span> <span class="n">PAI</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="c1"># Initialize StateVariables object</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StateVariables</span><span class="p">(</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">kiosk</span><span class="p">,</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="n">publish</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">,</span> <span class="s2">&quot;TWLV&quot;</span><span class="p">,</span> <span class="s2">&quot;WLV&quot;</span><span class="p">],</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">LV</span><span class="o">=</span><span class="n">LV</span><span class="p">,</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="n">SLA</span><span class="o">=</span><span class="n">SLA</span><span class="p">,</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="n">LVAGE</span><span class="o">=</span><span class="n">LVAGE</span><span class="p">,</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="n">LAIEM</span><span class="o">=</span><span class="n">LAIEM</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="n">LASUM</span><span class="o">=</span><span class="n">LASUM</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="n">LAIEXP</span><span class="o">=</span><span class="n">LAIEXP</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="n">LAIMAX</span><span class="o">=</span><span class="n">LAIMAX</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">LAI</span><span class="o">=</span><span class="n">LAI</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">WLV</span><span class="o">=</span><span class="n">WLV</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="n">DWLV</span><span class="o">=</span><span class="n">DWLV</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="n">TWLV</span><span class="o">=</span><span class="n">TWLV</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.calc_rates" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calc_rates</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calc_rates</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n"><span title="datetime.date">date</span></span><span class="p">,</span> <span class="n">drv</span><span class="p">:</span> <span class="n"><span title="pcse.base.weather.WeatherDataContainer">WeatherDataContainer</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the rates of change for the leaf dynamics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>day</code></b>
              (<code><span title="datetime.date">date</span></code>)
          –
          <div class="doc-md-description">
            <p>The current date of the simulation.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>drv</code></b>
              (<code><span title="pcse.base.weather.WeatherDataContainer">WeatherDataContainer</span></code>)
          –
          <div class="doc-md-description">
            <p>A dictionary-like container holding
weather data elements as key/value. The values are
arrays or scalars. See PCSE documentation for details.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/leaf_dynamics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="nd">@prepare_rates</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">drv</span><span class="p">:</span> <span class="n">WeatherDataContainer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the rates of change for the leaf dynamics.</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        day (datetime.date, optional): The current date of the simulation.</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        drv (WeatherDataContainer, optional): A dictionary-like container holding</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">            weather data elements as key/value. The values are</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">            arrays or scalars. See PCSE documentation for details.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="c1"># If DVS &lt; 0, the crop has not yet emerged, so we zerofy the rates using mask</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="c1"># A mask (0 if DVS &lt; 0, 1 if DVS &gt;= 0)</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="n">DVS</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s2">&quot;DVS&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">dvs_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">DVS</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="c1"># Growth rate leaves</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="c1"># weight of new leaves</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="n">r</span><span class="o">.</span><span class="n">GRLV</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">k</span><span class="o">.</span><span class="n">ADMI</span> <span class="o">*</span> <span class="n">k</span><span class="o">.</span><span class="n">FL</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="c1"># death of leaves due to water/oxygen stress</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="n">RFTRA</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">RFTRA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="n">PERDL</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">PERDL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DSLV1</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">WLV</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">RFTRA</span><span class="p">)</span> <span class="o">*</span> <span class="n">PERDL</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="c1"># death due to self shading cause by high LAI</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="n">DVS</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">[</span><span class="s2">&quot;DVS&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="n">KDIFTB</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">KDIFTB</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="n">LAICR</span> <span class="o">=</span> <span class="mf">3.2</span> <span class="o">/</span> <span class="n">KDIFTB</span><span class="p">(</span><span class="n">DVS</span><span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DSLV2</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">WLV</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mf">0.03</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">LAI</span> <span class="o">-</span> <span class="n">LAICR</span><span class="p">)</span> <span class="o">/</span> <span class="n">LAICR</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="c1"># Death of leaves due to frost damage as determined by</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="c1"># Reduction Factor Frost &quot;RF_FROST&quot;</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="k">if</span> <span class="s2">&quot;RF_FROST&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">:</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="n">r</span><span class="o">.</span><span class="n">DSLV3</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">WLV</span> <span class="o">*</span> <span class="n">k</span><span class="o">.</span><span class="n">RF_FROST</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">r</span><span class="o">.</span><span class="n">DSLV3</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">WLV</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DSLV3</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">DSLV3</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="c1"># leaf death equals maximum of water stress, shading and frost</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DSLV</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">DSLV1</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">DSLV2</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">DSLV3</span><span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DSLV</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">DSLV</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="c1"># Determine how much leaf biomass classes have to die in states.LV,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="c1"># given the a life span &gt; SPAN, these classes will be accumulated</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="c1"># in DALV.</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="c1"># Note that the actual leaf death is imposed on the array LV during the</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="c1"># state integration step.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="n">tSPAN</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="n">p</span><span class="o">.</span><span class="n">SPAN</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">LVAGE</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="p">)</span>  <span class="c1"># Broadcast to same shape</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="c1"># Using a sigmoid here instead of a conditional statement on the value of</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="c1"># SPAN because the latter would not allow for the gradient to be tracked.</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="c1"># the if statement `p.SPAN.requires_grad` to avoid unnecessary</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="c1"># approximation when SPAN is not a learnable parameter.</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="c1"># here we use STE (straight through estimator) method.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="c1"># TODO: sharpness can be exposed as a parameter</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">SPAN</span><span class="o">.</span><span class="n">requires_grad</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="c1"># soft mask using sigmoid</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="n">soft_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>            <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">LVAGE</span> <span class="o">-</span> <span class="n">tSPAN</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigmoid_epsilon</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigmoid_sharpness</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="c1"># originial hard mask</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="n">hard_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">LVAGE</span> <span class="o">&gt;</span> <span class="n">tSPAN</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="c1"># STE method. Here detach is used to stop the gradient flow. This</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="c1"># way, during backpropagation, the gradient is computed only through</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="c1"># the `soft_mask``, while during the forward pass, the `hard_mask``</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="c1"># is used.</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="n">span_mask</span> <span class="o">=</span> <span class="n">hard_mask</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="o">+</span> <span class="n">soft_mask</span> <span class="o">-</span> <span class="n">soft_mask</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">span_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">LVAGE</span> <span class="o">&gt;</span> <span class="n">tSPAN</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DALV</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">span_mask</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">LV</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DALV</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">DALV</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="c1"># Total death rate leaves</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DRLV</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">DSLV</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">DALV</span><span class="p">)</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="c1"># Get the temperature from the drv</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="n">TEMP</span> <span class="o">=</span> <span class="n">_get_drv</span><span class="p">(</span><span class="n">drv</span><span class="o">.</span><span class="n">TEMP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="c1"># physiologic ageing of leaves per time step</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="n">TBASE</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">TBASE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="n">FYSAGE</span> <span class="o">=</span> <span class="p">(</span><span class="n">TEMP</span> <span class="o">-</span> <span class="n">TBASE</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">35.0</span> <span class="o">-</span> <span class="n">TBASE</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="n">r</span><span class="o">.</span><span class="n">FYSAGE</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">FYSAGE</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="c1"># specific leaf area of leaves per time step</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="n">SLATB</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">SLATB</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="n">r</span><span class="o">.</span><span class="n">SLAT</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">SLATB</span><span class="p">(</span><span class="n">DVS</span><span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="c1"># leaf area not to exceed exponential growth curve</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="n">is_lai_exp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">LAIEXP</span> <span class="o">&lt;</span> <span class="mf">6.0</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="n">DTEFF</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">TEMP</span> <span class="o">-</span> <span class="n">TBASE</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="c1"># NOTE: conditional statements do not allow for the gradient to be</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="c1"># tracked through the condition. Thus, the gradient with respect to</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="c1"># parameters that contribute to `is_lai_exp` (e.g. RGRLAI and TBASE)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>    <span class="c1"># are expected to be incorrect.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>    <span class="n">RGRLAI</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">RGRLAI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="n">r</span><span class="o">.</span><span class="n">GLAIEX</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="n">dvs_mask</span><span class="o">.</span><span class="n">bool</span><span class="p">(),</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_lai_exp</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">LAIEXP</span> <span class="o">*</span> <span class="n">RGRLAI</span> <span class="o">*</span> <span class="n">DTEFF</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">GLAIEX</span><span class="p">),</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_zero</span><span class="p">,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="c1"># source-limited increase in leaf area</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="n">r</span><span class="o">.</span><span class="n">GLASOL</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="n">dvs_mask</span><span class="o">.</span><span class="n">bool</span><span class="p">(),</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_lai_exp</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">GRLV</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">SLAT</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">GLASOL</span><span class="p">),</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_zero</span><span class="p">,</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="p">)</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="c1"># sink-limited increase in leaf area</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>    <span class="n">GLA</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">GLAIEX</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">GLASOL</span><span class="p">)</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="c1"># adjustment of specific leaf area of youngest leaf class</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="n">r</span><span class="o">.</span><span class="n">SLAT</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="n">dvs_mask</span><span class="o">.</span><span class="n">bool</span><span class="p">(),</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="n">is_lai_exp</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">GRLV</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">),</span> <span class="n">GLA</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">GRLV</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">SLAT</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="p">),</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_zero</span><span class="p">,</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.leaf_dynamics.WOFOST_Leaf_Dynamics.integrate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">integrate</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">integrate</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n"><span title="datetime.date">date</span></span><span class="p">,</span> <span class="n">delt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Integrate the leaf dynamics state variables.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>day</code></b>
              (<code><span title="datetime.date">date</span></code>)
          –
          <div class="doc-md-description">
            <p>The current date of the simulation.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>delt</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>The time step for integration. Defaults to 1.0.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/leaf_dynamics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="nd">@prepare_states</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="k">def</span><span class="w"> </span><span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">delt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrate the leaf dynamics state variables.</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        day (datetime.date, optional): The current date of the simulation.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        delt (float, optional): The time step for integration. Defaults to 1.0.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="c1"># TODO check if DVS &lt; 0 and skip integration needed</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>    <span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="c1"># --------- leave death ---------</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="n">tLV</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">LV</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="n">tSLA</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">SLA</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="n">tLVAGE</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">LVAGE</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">tDRLV</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">rates</span><span class="o">.</span><span class="n">DRLV</span><span class="p">,</span> <span class="n">tLV</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="c1"># Leaf death is imposed on leaves from the oldest ones.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="c1"># Calculate the cumulative sum of weights after leaf death, and</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>    <span class="c1"># find out which leaf classes are dead (negative weights)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="n">weight_cumsum</span> <span class="o">=</span> <span class="n">tLV</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">tDRLV</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="n">is_alive</span> <span class="o">=</span> <span class="n">weight_cumsum</span> <span class="o">&gt;=</span> <span class="mi">0</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="c1"># Adjust value of oldest leaf class, i.e. the first non-zero</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>    <span class="c1"># weight along the time axis (the last dimension).</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="c1"># Cast argument to int because torch.argmax requires it to be numeric</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="n">idx_oldest</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">is_alive</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="n">new_biomass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">take_along_dim</span><span class="p">(</span><span class="n">weight_cumsum</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">idx_oldest</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="n">tLV</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tLV</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">idx_oldest</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">new_biomass</span><span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="c1"># Integration of physiological age</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="c1"># Zero out all dead leaf classes</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="c1"># NOTE: conditional statements do not allow for the gradient to be</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="c1"># tracked through the condition. Thus, the gradient with respect to</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="c1"># parameters that contribute to `is_alive` are expected to be incorrect.</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">tLV</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_alive</span><span class="p">,</span> <span class="n">tLV</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">tLVAGE</span> <span class="o">=</span> <span class="n">tLVAGE</span> <span class="o">+</span> <span class="n">rates</span><span class="o">.</span><span class="n">FYSAGE</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="n">tLVAGE</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_alive</span><span class="p">,</span> <span class="n">tLVAGE</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="n">tSLA</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_alive</span><span class="p">,</span> <span class="n">tSLA</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="c1"># --------- leave growth ---------</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">day</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">START_DATE</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="n">delt</span><span class="p">)</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="n">tLV</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">rates</span><span class="o">.</span><span class="n">GRLV</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="n">tSLA</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">rates</span><span class="o">.</span><span class="n">SLAT</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>    <span class="n">tLVAGE</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>    <span class="c1"># calculation of new leaf area</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>    <span class="n">states</span><span class="o">.</span><span class="n">LASUM</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tLV</span> <span class="o">*</span> <span class="n">tSLA</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>    <span class="n">states</span><span class="o">.</span><span class="n">LAI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_LAI</span><span class="p">()</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="n">states</span><span class="o">.</span><span class="n">LAIMAX</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">states</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span> <span class="n">states</span><span class="o">.</span><span class="n">LAIMAX</span><span class="p">)</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>    <span class="c1"># exponential growth curve</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="n">states</span><span class="o">.</span><span class="n">LAIEXP</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">LAIEXP</span> <span class="o">+</span> <span class="n">rates</span><span class="o">.</span><span class="n">GLAIEX</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="c1"># Update leaf biomass states</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="n">states</span><span class="o">.</span><span class="n">WLV</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tLV</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="n">states</span><span class="o">.</span><span class="n">DWLV</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">DWLV</span> <span class="o">+</span> <span class="n">rates</span><span class="o">.</span><span class="n">DRLV</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>    <span class="n">states</span><span class="o">.</span><span class="n">TWLV</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">WLV</span> <span class="o">+</span> <span class="n">states</span><span class="o">.</span><span class="n">DWLV</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="c1"># Store final leaf biomass deques</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">LV</span> <span class="o">=</span> <span class="n">tLV</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">SLA</span> <span class="o">=</span> <span class="n">tSLA</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">LVAGE</span> <span class="o">=</span> <span class="n">tLVAGE</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics</span>


</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pcse.base.SimulationObject">SimulationObject</span></code></p>



        <p>Root biomass dynamics and rooting depth.</p>
<p>Root growth and root biomass dynamics in WOFOST are separate processes,
with the only exception that root growth stops when no more biomass is sent
to the root system.</p>
<p>Root biomass increase results from the assimilates partitioned to
the root system. Root death is defined as the current root biomass
multiplied by a relative death rate (<code>RDRRTB</code>). The latter as a function
of the development stage (<code>DVS</code>).</p>
<p>Increase in root depth is a simple linear expansion over time until the
maximum rooting depth (<code>RDM</code>) is reached.</p>
<p><strong>Simulation parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>RDI</td>
<td>Initial rooting depth</td>
<td>SCr</td>
<td>cm</td>
</tr>
<tr>
<td>RRI</td>
<td>Daily increase in rooting depth</td>
<td>SCr</td>
<td>cm day⁻¹</td>
</tr>
<tr>
<td>RDMCR</td>
<td>Maximum rooting depth of the crop</td>
<td>SCR</td>
<td>cm</td>
</tr>
<tr>
<td>RDMSOL</td>
<td>Maximum rooting depth of the soil</td>
<td>SSo</td>
<td>cm</td>
</tr>
<tr>
<td>TDWI</td>
<td>Initial total crop dry weight</td>
<td>SCr</td>
<td>kg ha⁻¹</td>
</tr>
<tr>
<td>IAIRDU</td>
<td>Presence of air ducts in the root (1) or not (0)</td>
<td>SCr</td>
<td>-</td>
</tr>
<tr>
<td>RDRRTB</td>
<td>Relative death rate of roots as a function of development stage</td>
<td>TCr</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>State variables</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>RD</td>
<td>Current rooting depth</td>
<td>Y</td>
<td>cm</td>
</tr>
<tr>
<td>RDM</td>
<td>Maximum attainable rooting depth at the minimum of the soil and crop maximum rooting depth</td>
<td>N</td>
<td>cm</td>
</tr>
<tr>
<td>WRT</td>
<td>Weight of living roots</td>
<td>Y</td>
<td>kg ha⁻¹</td>
</tr>
<tr>
<td>DWRT</td>
<td>Weight of dead roots</td>
<td>N</td>
<td>kg ha⁻¹</td>
</tr>
<tr>
<td>TWRT</td>
<td>Total weight of roots</td>
<td>Y</td>
<td>kg ha⁻¹</td>
</tr>
</tbody>
</table>
<p><strong>Rate variables</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Pbl</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>RR</td>
<td>Growth rate root depth</td>
<td>N</td>
<td>cm</td>
</tr>
<tr>
<td>GRRT</td>
<td>Growth rate root biomass</td>
<td>N</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>DRRT</td>
<td>Death rate root biomass</td>
<td>N</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>GWRT</td>
<td>Net change in root biomass</td>
<td>N</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
</tbody>
</table>
<p><strong>Signals send or handled</strong></p>
<p>None</p>
<p><strong>External dependencies:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Provided by</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>DVS</td>
<td>Crop development stage</td>
<td>DVS_Phenology</td>
<td>-</td>
</tr>
<tr>
<td>DMI</td>
<td>Total dry matter increase</td>
<td>CropSimulation</td>
<td>kg ha⁻¹ d⁻¹</td>
</tr>
<tr>
<td>FR</td>
<td>Fraction biomass to roots</td>
<td>DVS_Partitioning</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Outputs:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Provided by</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>RD</td>
<td>Current rooting depth</td>
<td>Y</td>
<td>cm</td>
</tr>
<tr>
<td>TWRT</td>
<td>Total weight of roots</td>
<td>Y</td>
<td>kg ha⁻¹</td>
</tr>
</tbody>
</table>
<p><strong>Gradient mapping (which parameters have a gradient):</strong></p>
<table>
<thead>
<tr>
<th>Output</th>
<th>Parameters influencing it</th>
</tr>
</thead>
<tbody>
<tr>
<td>RD</td>
<td>RDI, RRI, RDMCR, RDMSOL</td>
</tr>
<tr>
<td>TWRT</td>
<td>TDWI, RDRRTB</td>
</tr>
</tbody>
</table>
<p>[!NOTE]
Notice that the gradient ∂TWRT/∂RDRRTB is zero.</p>
<p><strong>IMPORTANT NOTICE</strong></p>
<p>Currently root development is linear and depends only on the fraction of assimilates
send to the roots (FR) and not on the amount of assimilates itself. This means that
roots also grow through the winter when there is no assimilation due to low
temperatures. There has been a discussion to change this behaviour and make root growth
dependent on the assimilates send to the roots: so root growth stops when there are
no assimilates available for growth.</p>
<p>Finally, we decided not to change the root model and keep the original WOFOST approach
because of the following reasons:
- A dry top layer in the soil could create a large drought stress that reduces the
  assimilates to zero. In this situation the roots would not grow if dependent on the
  assimilates, while water is available in the zone just below the root zone. Therefore
  a dependency on the amount of assimilates could create model instability in dry
  conditions (e.g. Southern-Mediterranean, etc.).
- Other solutions to alleviate the problem above were explored: only put this limitation
  after a certain development stage, putting a dependency on soil moisture levels in the
  unrooted soil compartment. All these solutions were found to introduce arbitrary
  parameters that have no clear explanation. Therefore all proposed solutions were discarded.</p>
<p>We conclude that our current knowledge on root development is insufficient to propose a
better and more biophysical approach to root development in WOFOST.</p>

          











<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            initialize (diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.initialize)" href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.initialize">initialize</a></code></b>
            –
            <div class="doc-md-description">
              <p>Initialize the model.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            calc_rates (diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.calc_rates)" href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.calc_rates">calc_rates</a></code></b>
            –
            <div class="doc-md-description">
              <p>Calculate the rates of change of the state variables.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            integrate (diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.integrate)" href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.integrate">integrate</a></code></b>
            –
            <div class="doc-md-description">
              <p>Integrate the state variables using the rates of change.</p>
            </div>
          </li>
    </ul>




<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            device


  
      property
   (diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.device)" href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.device">device</a></code></b>
          –
          <div class="doc-md-description">
            <p>Get device from ComputeConfig.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            dtype


  
      property
   (diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.dtype)" href="#diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.dtype">dtype</a></code></b>
          –
          <div class="doc-md-description">
            <p>Get dtype from ComputeConfig.</p>
          </div>
        </li>
    </ul>




<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.device" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">device</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">device</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get device from ComputeConfig.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.dtype" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">dtype</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">dtype</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get dtype from ComputeConfig.</p>

          
    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.initialize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">initialize</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">initialize</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n"><span title="datetime.date">date</span></span><span class="p">,</span> <span class="n">kiosk</span><span class="p">:</span> <span class="n"><span title="pcse.base.variablekiosk.VariableKiosk">VariableKiosk</span></span><span class="p">,</span> <span class="n">parvalues</span><span class="p">:</span> <span class="n"><span title="pcse.base.parameter_providers.ParameterProvider">ParameterProvider</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>day</code></b>
              (<code><span title="datetime.date">date</span></code>)
          –
          <div class="doc-md-description">
            <p>The starting date of the simulation.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>kiosk</code></b>
              (<code><span title="pcse.base.variablekiosk.VariableKiosk">VariableKiosk</span></code>)
          –
          <div class="doc-md-description">
            <p>A container for registering and publishing
(internal and external) state variables. See PCSE documentation for
details.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>parvalues</code></b>
              (<code><span title="pcse.base.parameter_providers.ParameterProvider">ParameterProvider</span></code>)
          –
          <div class="doc-md-description">
            <p>A dictionary-like container holding
all parameter sets (crop, soil, site) as key/value. The values are
arrays or scalars. See PCSE documentation for details.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/root_dynamics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">kiosk</span><span class="p">:</span> <span class="n">VariableKiosk</span><span class="p">,</span> <span class="n">parvalues</span><span class="p">:</span> <span class="n">ParameterProvider</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the model.</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        day (datetime.date): The starting date of the simulation.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        kiosk (VariableKiosk): A container for registering and publishing</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">            (internal and external) state variables. See PCSE documentation for</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">            details.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        parvalues (ParameterProvider): A dictionary-like container holding</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">            all parameter sets (crop, soil, site) as key/value. The values are</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">            arrays or scalars. See PCSE documentation for details.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span> <span class="o">=</span> <span class="n">kiosk</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Parameters</span><span class="p">(</span><span class="n">parvalues</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RateVariables</span><span class="p">(</span><span class="n">kiosk</span><span class="p">,</span> <span class="n">publish</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DRRT&quot;</span><span class="p">,</span> <span class="s2">&quot;GRRT&quot;</span><span class="p">])</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="c1"># INITIAL STATES</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span> <span class="o">=</span> <span class="n">_get_params_shape</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="c1"># Initial root depth states</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="n">RDI</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">RDI</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="n">RDMCR</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">RDMCR</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="n">RDMSOL</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">RDMSOL</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="n">rdmax</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">RDI</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">RDMCR</span><span class="p">,</span> <span class="n">RDMSOL</span><span class="p">))</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="n">RDM</span> <span class="o">=</span> <span class="n">rdmax</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="n">RD</span> <span class="o">=</span> <span class="n">RDI</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="c1"># Initial root biomass states</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="n">TDWI</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">TDWI</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">FR</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">[</span><span class="s2">&quot;FR&quot;</span><span class="p">],</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="n">WRT</span> <span class="o">=</span> <span class="n">TDWI</span> <span class="o">*</span> <span class="n">FR</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="n">DWRT</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="n">TWRT</span> <span class="o">=</span> <span class="n">WRT</span> <span class="o">+</span> <span class="n">DWRT</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StateVariables</span><span class="p">(</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="n">kiosk</span><span class="p">,</span> <span class="n">publish</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RD&quot;</span><span class="p">,</span> <span class="s2">&quot;WRT&quot;</span><span class="p">,</span> <span class="s2">&quot;TWRT&quot;</span><span class="p">],</span> <span class="n">RD</span><span class="o">=</span><span class="n">RD</span><span class="p">,</span> <span class="n">RDM</span><span class="o">=</span><span class="n">RDM</span><span class="p">,</span> <span class="n">WRT</span><span class="o">=</span><span class="n">WRT</span><span class="p">,</span> <span class="n">DWRT</span><span class="o">=</span><span class="n">DWRT</span><span class="p">,</span> <span class="n">TWRT</span><span class="o">=</span><span class="n">TWRT</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.calc_rates" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calc_rates</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calc_rates</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n"><span title="datetime.date">date</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">drv</span><span class="p">:</span> <span class="n"><span title="pcse.base.weather.WeatherDataContainer">WeatherDataContainer</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the rates of change of the state variables.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>day</code></b>
              (<code><span title="datetime.date">date</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>The current date of the simulation.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>drv</code></b>
              (<code><span title="pcse.base.weather.WeatherDataContainer">WeatherDataContainer</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A dictionary-like container holding
weather data elements as key/value. The values are
arrays or scalars. See PCSE documentation for details.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/root_dynamics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="nd">@prepare_rates</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">drv</span><span class="p">:</span> <span class="n">WeatherDataContainer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the rates of change of the state variables.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        day (datetime.date, optional): The current date of the simulation.</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        drv (WeatherDataContainer, optional): A dictionary-like container holding</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">            weather data elements as key/value. The values are</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">            arrays or scalars. See PCSE documentation for details.</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="c1"># If DVS &lt; 0, the crop has not yet emerged, so we zerofy the rates using mask.</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="c1"># Make a mask (0 if DVS &lt; 0, 1 if DVS &gt;= 0)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="n">DVS</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s2">&quot;DVS&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="n">dvs_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">DVS</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="c1"># Increase in root biomass</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="n">FR</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s2">&quot;FR&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="n">DMI</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s2">&quot;DMI&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="n">RDRRTB</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">RDRRTB</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">r</span><span class="o">.</span><span class="n">GRRT</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">FR</span> <span class="o">*</span> <span class="n">DMI</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="n">r</span><span class="o">.</span><span class="n">DRRT</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">WRT</span> <span class="o">*</span> <span class="n">RDRRTB</span><span class="p">(</span><span class="n">DVS</span><span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="n">r</span><span class="o">.</span><span class="n">GWRT</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">GRRT</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">DRRT</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="c1"># Increase in root depth</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="n">RRI</span> <span class="o">=</span> <span class="n">_broadcast_to</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">RRI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="n">r</span><span class="o">.</span><span class="n">RR</span> <span class="o">=</span> <span class="n">dvs_mask</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">minimum</span><span class="p">((</span><span class="n">s</span><span class="o">.</span><span class="n">RDM</span> <span class="o">-</span> <span class="n">s</span><span class="o">.</span><span class="n">RD</span><span class="p">),</span> <span class="n">RRI</span><span class="p">)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="c1"># Do not let the roots growth if partioning to the roots</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="c1"># (variable FR) is zero.</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">FR</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="n">r</span><span class="o">.</span><span class="n">RR</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">RR</span> <span class="o">*</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">dvs_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.crop.root_dynamics.WOFOST_Root_Dynamics.integrate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">integrate</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">integrate</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="n"><span title="datetime.date">date</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">delt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Integrate the state variables using the rates of change.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>day</code></b>
              (<code><span title="datetime.date">date</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>The current date of the simulation.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>delt</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>The time step for integration. Defaults to 1.0.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/crop/root_dynamics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="nd">@prepare_states</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="k">def</span><span class="w"> </span><span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">delt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrate the state variables using the rates of change.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        day (datetime.date, optional): The current date of the simulation.</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        delt (float, optional): The time step for integration. Defaults to 1.0.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="c1"># Dry weight of living roots</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="n">states</span><span class="o">.</span><span class="n">WRT</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">WRT</span> <span class="o">+</span> <span class="n">rates</span><span class="o">.</span><span class="n">GWRT</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="c1"># Dry weight of dead roots</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="n">states</span><span class="o">.</span><span class="n">DWRT</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">DWRT</span> <span class="o">+</span> <span class="n">rates</span><span class="o">.</span><span class="n">DRRT</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="c1"># Total weight dry + living roots</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="n">states</span><span class="o">.</span><span class="n">TWRT</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">WRT</span> <span class="o">+</span> <span class="n">states</span><span class="o">.</span><span class="n">DWRT</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="c1"># New root depth</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="n">states</span><span class="o">.</span><span class="n">RD</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">RD</span> <span class="o">+</span> <span class="n">rates</span><span class="o">.</span><span class="n">RR</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="utility-under-development"><strong>Utility (under development)</strong></h2>


<div class="doc doc-object doc-class">



<h3 id="diffwofost.physical_models.config.Configuration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">diffwofost.physical_models.config.Configuration</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">Configuration</span><span class="p">(</span><span class="n">CROP</span><span class="p">:</span> <span class="n"><span title="type">type</span></span><span class="p">[</span><span class="n"><span title="pcse.base.SimulationObject">SimulationObject</span></span><span class="p">],</span> <span class="n">SOIL</span><span class="p">:</span> <span class="n"><span title="type">type</span></span><span class="p">[</span><span class="n"><span title="pcse.base.SimulationObject">SimulationObject</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">AGROMANAGEMENT</span><span class="p">:</span> <span class="n"><span title="type">type</span></span><span class="p">[</span><span class="n"><span title="pcse.base.AncillaryObject">AncillaryObject</span></span><span class="p">]</span> <span class="o">=</span> <span class="n"><span title="pcse.agromanager.AgroManager">AgroManager</span></span><span class="p">,</span> <span class="n">OUTPUT_VARS</span><span class="p">:</span> <span class="n"><span title="list">list</span></span> <span class="o">=</span> <span class="n"><span title="list">list</span></span><span class="p">(),</span> <span class="n">SUMMARY_OUTPUT_VARS</span><span class="p">:</span> <span class="n"><span title="list">list</span></span> <span class="o">=</span> <span class="n"><span title="list">list</span></span><span class="p">(),</span> <span class="n">TERMINAL_OUTPUT_VARS</span><span class="p">:</span> <span class="n"><span title="list">list</span></span> <span class="o">=</span> <span class="n"><span title="list">list</span></span><span class="p">(),</span> <span class="n">OUTPUT_INTERVAL</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">=</span> <span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="n">OUTPUT_INTERVAL_DAYS</span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">OUTPUT_WEEKDAY</span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">model_config_file</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="n"><span title="pathlib.Path">Path</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents first">



        <p>Class to store model configuration from a PCSE configuration files.</p>

          











<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            from_pcse_config_file


  
      classmethod
   (diffwofost.physical_models.config.Configuration.from_pcse_config_file)" href="#diffwofost.physical_models.config.Configuration.from_pcse_config_file">from_pcse_config_file</a></code></b>
            –
            <div class="doc-md-description">
              <p>Load the model configuration from a PCSE configuration file.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            update_output_variable_lists (diffwofost.physical_models.config.Configuration.update_output_variable_lists)" href="#diffwofost.physical_models.config.Configuration.update_output_variable_lists">update_output_variable_lists</a></code></b>
            –
            <div class="doc-md-description">
              <p>Updates the lists of output variables that are defined in the configuration file.</p>
            </div>
          </li>
    </ul>






<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.config.Configuration.from_pcse_config_file" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">from_pcse_config_file</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">from_pcse_config_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="n"><span title="pathlib.Path">Path</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing.Self">Self</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load the model configuration from a PCSE configuration file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>filename</code></b>
              (<code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>)
          –
          <div class="doc-md-description">
            <p>Path to the configuraiton file. The path is first
interpreted with respect to the current working directory and, if not found, it will
then be interpreted with respect to the <code>conf</code> folder in the PCSE package.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Configuration</code></b> (              <code><span title="typing.Self">Self</span></code>
)          –
          <div class="doc-md-description">
            <p>Model configuration instance</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            –
          <div class="doc-md-description">
            <p>if the configuraiton file does not exist</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="RuntimeError">RuntimeError</span></code>
            –
          <div class="doc-md-description">
            <p>if parsing the configuration file fails</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="k">def</span><span class="w"> </span><span class="nf">from_pcse_config_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the model configuration from a PCSE configuration file.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        filename (str | pathlib.Path): Path to the configuraiton file. The path is first</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">            interpreted with respect to the current working directory and, if not found, it will</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">            then be interpreted with respect to the `conf` folder in the PCSE package.</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        Configuration: Model configuration instance</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        FileNotFoundError: if the configuraiton file does not exist</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        RuntimeError: if parsing the configuration file fails</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">()</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="n">model_config_file</span> <span class="o">=</span> <span class="n">path</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">pcse_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pcse</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">model_config_file</span> <span class="o">=</span> <span class="n">pcse_dir</span> <span class="o">/</span> <span class="s2">&quot;conf&quot;</span> <span class="o">/</span> <span class="n">path</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="n">model_config_file</span> <span class="o">=</span> <span class="n">model_config_file</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="c1"># check that configuration file exists</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">model_config_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;PCSE model configuration file does not exist: </span><span class="si">{</span><span class="n">model_config_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="c1"># store for later use</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;model_config_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_config_file</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="c1"># Load file using execfile</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">loc</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">bytecode</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">model_config_file</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">model_config_file</span><span class="p">,</span> <span class="s2">&quot;exec&quot;</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">exec</span><span class="p">(</span><span class="n">bytecode</span><span class="p">,</span> <span class="p">{},</span> <span class="n">loc</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to load configuration from file </span><span class="si">{</span><span class="n">model_config_file</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="c1"># Add the descriptive header for later use</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">if</span> <span class="s2">&quot;__doc__&quot;</span> <span class="ow">in</span> <span class="n">loc</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">desc</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;__doc__&quot;</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="n">description</span> <span class="o">=</span> <span class="n">desc</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="k">if</span> <span class="n">description</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="n">description</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="c1"># Loop through the attributes in the configuration file</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.config.Configuration.update_output_variable_lists" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">update_output_variable_lists</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">update_output_variable_lists</span><span class="p">(</span><span class="n">output_vars</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="n"><span title="list">list</span></span> <span class="o">|</span> <span class="n"><span title="tuple">tuple</span></span> <span class="o">|</span> <span class="n"><span title="set">set</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">summary_vars</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="n"><span title="list">list</span></span> <span class="o">|</span> <span class="n"><span title="tuple">tuple</span></span> <span class="o">|</span> <span class="n"><span title="set">set</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">terminal_vars</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="n"><span title="list">list</span></span> <span class="o">|</span> <span class="n"><span title="tuple">tuple</span></span> <span class="o">|</span> <span class="n"><span title="set">set</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Updates the lists of output variables that are defined in the configuration file.</p>
<p>This is useful because sometimes you want the flexibility to get access to an additional
model variable which is not in the standard list of variables defined in the model
configuration file. The more elegant way is to define your own configuration file, but this
adds some flexibility particularly for use in jupyter notebooks and exploratory analysis.</p>
<p>Note that there is a different behaviour given the type of the variable provided. List and
string inputs will extend the list of variables, while set/tuple inputs will replace the
current list.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>output_vars</code></b>
              (<code><span title="str">str</span> | <span title="list">list</span> | <span title="tuple">tuple</span> | <span title="set">set</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>the variable names to add/replace for the OUTPUT_VARS configuration
variable</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>summary_vars</code></b>
              (<code><span title="str">str</span> | <span title="list">list</span> | <span title="tuple">tuple</span> | <span title="set">set</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>the variable names to add/replace for the SUMMARY_OUTPUT_VARS
configuration variable</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>terminal_vars</code></b>
              (<code><span title="str">str</span> | <span title="list">list</span> | <span title="tuple">tuple</span> | <span title="set">set</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>the variable names to add/replace for the TERMINAL_OUTPUT_VARS
configuration variable</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="TypeError">TypeError</span></code>
            –
          <div class="doc-md-description">
            <p>if the type of the input arguments is not recognized</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_output_variable_lists</span><span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="n">output_vars</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="nb">set</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="n">summary_vars</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="nb">set</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="n">terminal_vars</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="nb">set</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="p">):</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates the lists of output variables that are defined in the configuration file.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    This is useful because sometimes you want the flexibility to get access to an additional</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    model variable which is not in the standard list of variables defined in the model</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    configuration file. The more elegant way is to define your own configuration file, but this</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    adds some flexibility particularly for use in jupyter notebooks and exploratory analysis.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    Note that there is a different behaviour given the type of the variable provided. List and</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    string inputs will extend the list of variables, while set/tuple inputs will replace the</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    current list.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        output_vars: the variable names to add/replace for the OUTPUT_VARS configuration</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">            variable</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        summary_vars: the variable names to add/replace for the SUMMARY_OUTPUT_VARS</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">            configuration variable</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        terminal_vars: the variable names to add/replace for the TERMINAL_OUTPUT_VARS</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">            configuration variable</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        TypeError: if the type of the input arguments is not recognized</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="n">config_varnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;OUTPUT_VARS&quot;</span><span class="p">,</span> <span class="s2">&quot;SUMMARY_OUTPUT_VARS&quot;</span><span class="p">,</span> <span class="s2">&quot;TERMINAL_OUTPUT_VARS&quot;</span><span class="p">]</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="k">for</span> <span class="n">varitems</span><span class="p">,</span> <span class="n">config_varname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="p">[</span><span class="n">output_vars</span><span class="p">,</span> <span class="n">summary_vars</span><span class="p">,</span> <span class="n">terminal_vars</span><span class="p">],</span> <span class="n">config_varnames</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="p">):</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="k">if</span> <span class="n">varitems</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="k">continue</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">varitems</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># A string: we extend the current list</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_varname</span><span class="p">)</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">varitems</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">varitems</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># a list: we extend the current list</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_varname</span><span class="p">)</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">varitems</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">varitems</span><span class="p">,</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="nb">set</span><span class="p">):</span>  <span class="c1"># tuple/set we replace the current list</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_varname</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="n">attr</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="n">attr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">varitems</span><span class="p">))</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unrecognized input for `output_vars` to engine(): </span><span class="si">{</span><span class="n">output_vars</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="diffwofost.physical_models.config.ComputeConfig" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">diffwofost.physical_models.config.ComputeConfig</span>


</h3>


    <div class="doc doc-contents first">



        <p>Central configuration for device and dtype settings.</p>
<p>This class provides a centralized way to control PyTorch device and dtype
settings across all simulation objects in diffWOFOST. Instead of setting
device and dtype individually for each class, use this central configuration
to apply settings globally.</p>
<p><strong>Default Behavior:</strong></p>
<ul>
<li><strong>Device</strong>: Automatically defaults to 'cuda' if available, otherwise 'cpu'</li>
<li><strong>Dtype</strong>: Defaults to torch.float64</li>
</ul>
<p><strong>Basic Usage:</strong></p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; from diffwofost.physical_models.config import ComputeConfig
&gt;&gt;&gt; import torch
&gt;&gt;&gt;
&gt;&gt;&gt; # Set device to CPU
&gt;&gt;&gt; ComputeConfig.set_device(&#39;cpu&#39;)
&gt;&gt;&gt;
&gt;&gt;&gt; # Or use a torch.device object
&gt;&gt;&gt; ComputeConfig.set_device(torch.device(&#39;cuda&#39;))
&gt;&gt;&gt;
&gt;&gt;&gt; # Set dtype to float32
&gt;&gt;&gt; ComputeConfig.set_dtype(torch.float32)
&gt;&gt;&gt;
&gt;&gt;&gt; # Get current settings
&gt;&gt;&gt; device = ComputeConfig.get_device()  # Returns: torch.device(&#39;cpu&#39;)
&gt;&gt;&gt; dtype = ComputeConfig.get_dtype()    # Returns: torch.float32
</code></pre></div>
<p><strong>Using with Simulation Objects:</strong></p>
<p>All simulation objects (e.g., WOFOST_Leaf_Dynamics, WOFOST_Phenology)
automatically use the settings from ComputeConfig. No changes needed to
instantiation code:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; from diffwofost.physical_models.config import ComputeConfig
&gt;&gt;&gt; from diffwofost.physical_models.crop.leaf_dynamics import WOFOST_Leaf_Dynamics
&gt;&gt;&gt;
&gt;&gt;&gt; # Set global compute settings
&gt;&gt;&gt; ComputeConfig.set_device(&#39;cuda&#39;)
&gt;&gt;&gt; ComputeConfig.set_dtype(torch.float32)
&gt;&gt;&gt;
&gt;&gt;&gt; # Instantiate objects - they automatically use global settings
&gt;&gt;&gt; leaf_dynamics = WOFOST_Leaf_Dynamics()
</code></pre></div>
<p><strong>Switching Between Devices:</strong></p>
<p>Useful for switching between GPU training and CPU evaluation:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Train on GPU
&gt;&gt;&gt; ComputeConfig.set_device(&#39;cuda&#39;)
&gt;&gt;&gt; ComputeConfig.set_dtype(torch.float32)
&gt;&gt;&gt; # ... run training ...
&gt;&gt;&gt;
&gt;&gt;&gt; # Evaluate on CPU
&gt;&gt;&gt; ComputeConfig.set_device(&#39;cpu&#39;)
&gt;&gt;&gt; ComputeConfig.set_dtype(torch.float64)
&gt;&gt;&gt; # ... run evaluation ...
</code></pre></div>
<p><strong>Resetting to Defaults:</strong></p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; ComputeConfig.reset_to_defaults()
</code></pre></div>

          











<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            get_device


  
      classmethod
   (diffwofost.physical_models.config.ComputeConfig.get_device)" href="#diffwofost.physical_models.config.ComputeConfig.get_device">get_device</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the current device setting.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            set_device


  
      classmethod
   (diffwofost.physical_models.config.ComputeConfig.set_device)" href="#diffwofost.physical_models.config.ComputeConfig.set_device">set_device</a></code></b>
            –
            <div class="doc-md-description">
              <p>Set the device to use for tensor operations.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            get_dtype


  
      classmethod
   (diffwofost.physical_models.config.ComputeConfig.get_dtype)" href="#diffwofost.physical_models.config.ComputeConfig.get_dtype">get_dtype</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the current dtype setting.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            set_dtype


  
      classmethod
   (diffwofost.physical_models.config.ComputeConfig.set_dtype)" href="#diffwofost.physical_models.config.ComputeConfig.set_dtype">set_dtype</a></code></b>
            –
            <div class="doc-md-description">
              <p>Set the dtype to use for tensor creation.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            reset_to_defaults


  
      classmethod
   (diffwofost.physical_models.config.ComputeConfig.reset_to_defaults)" href="#diffwofost.physical_models.config.ComputeConfig.reset_to_defaults">reset_to_defaults</a></code></b>
            –
            <div class="doc-md-description">
              <p>Reset device and dtype to their default values.</p>
            </div>
          </li>
    </ul>






<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.config.ComputeConfig.get_device" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_device</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_device</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.device">device</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the current device setting.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="torch.device">device</span></code>
          –
          <div class="doc-md-description">
            <p>torch.device: The current device (cuda or cpu)</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span>
<span class="normal"><a href="#__codelineno-0-98">98</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_device</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current device setting.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        torch.device: The current device (cuda or cpu)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">cls</span><span class="o">.</span><span class="n">_initialize_defaults</span><span class="p">()</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_device</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.config.ComputeConfig.set_device" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_device</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">set_device</span><span class="p">(</span><span class="n">device</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="n"><span title="torch.device">device</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the device to use for tensor operations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>device</code></b>
              (<code><span title="str">str</span> | <span title="torch.device">device</span></code>)
          –
          <div class="doc-md-description">
            <p>Device to use ('cuda', 'cpu', or torch.device object)</p>
          </div>
        </li>
    </ul>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>ComputeConfig.set_device('cuda')
ComputeConfig.set_device(torch.device('cpu'))</p>
</blockquote>
</blockquote>
</blockquote>
</details>
          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_device</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the device to use for tensor operations.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        device (str | torch.device): Device to use (&#39;cuda&#39;, &#39;cpu&#39;, or torch.device object)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        &gt;&gt;&gt; ComputeConfig.set_device(&#39;cuda&#39;)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        &gt;&gt;&gt; ComputeConfig.set_device(torch.device(&#39;cpu&#39;))</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">device</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.config.ComputeConfig.get_dtype" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_dtype</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_dtype</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.dtype">dtype</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the current dtype setting.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="torch.dtype">dtype</span></code>
          –
          <div class="doc-md-description">
            <p>torch.dtype: The current dtype (e.g., torch.float32, torch.float64)</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_dtype</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current dtype setting.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        torch.dtype: The current dtype (e.g., torch.float32, torch.float64)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="bp">cls</span><span class="o">.</span><span class="n">_initialize_defaults</span><span class="p">()</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_dtype</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.config.ComputeConfig.set_dtype" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_dtype</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">set_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="torch.dtype">dtype</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the dtype to use for tensor creation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>dtype</code></b>
              (<code><span title="torch.dtype">dtype</span></code>)
          –
          <div class="doc-md-description">
            <p>PyTorch dtype (torch.float32, torch.float64, etc.)</p>
          </div>
        </li>
    </ul>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>ComputeConfig.set_dtype(torch.float32)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_dtype</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the dtype to use for tensor creation.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        dtype (torch.dtype): PyTorch dtype (torch.float32, torch.float64, etc.)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        &gt;&gt;&gt; ComputeConfig.set_dtype(torch.float32)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">cls</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="diffwofost.physical_models.config.ComputeConfig.reset_to_defaults" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">reset_to_defaults</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">reset_to_defaults</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Reset device and dtype to their default values.</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/diffwofost/physical_models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="k">def</span><span class="w"> </span><span class="nf">reset_to_defaults</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset device and dtype to their default values.&quot;&quot;&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="bp">cls</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="bp">cls</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="bp">cls</span><span class="o">.</span><span class="n">_initialize_defaults</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="diffwofost.physical_models.engine.Engine" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">diffwofost.physical_models.engine.Engine</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">Engine</span><span class="p">(</span><span class="n">parameterprovider</span><span class="p">,</span> <span class="n">weatherdataprovider</span><span class="p">,</span> <span class="n">agromanagement</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="n"><span title="pathlib.Path">Path</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-internal" title="            diffwofost.physical_models.config.Configuration


  
      dataclass
  " href="#diffwofost.physical_models.config.Configuration">Configuration</a></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            diffwofost.physical_models.engine.Engine" href="#diffwofost.physical_models.engine.Engine">Engine</a></code></p>



          












                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/diffwofost/physical_models/engine.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">parameterprovider</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">weatherdataprovider</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">agromanagement</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">config</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="n">Configuration</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="p">):</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">BaseEngine</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="c1"># If a path is given, load the model configuration from a PCSE config file</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">):</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">from_pcse_config_file</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span> <span class="o">=</span> <span class="n">config</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">parameterprovider</span> <span class="o">=</span> <span class="n">parameterprovider</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="c1"># Variable kiosk for registering and publishing variables</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span> <span class="o">=</span> <span class="n">VariableKiosk</span><span class="p">()</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="c1"># Placeholder for variables to be saved during a model run</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_saved_output</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_saved_summary_output</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_saved_terminal_output</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="c1"># register handlers for starting/finishing the crop simulation, for</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="c1"># handling output and terminating the system</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_connect_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_CROP_START</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">crop_start</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_connect_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_CROP_FINISH</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">crop_finish</span><span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_connect_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_OUTPUT</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_connect_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_TERMINATE</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">terminate</span><span class="p">)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="c1"># Component for agromanagement</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agromanager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="o">.</span><span class="n">AGROMANAGEMENT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">,</span> <span class="n">agromanagement</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agromanager</span><span class="o">.</span><span class="n">start_date</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agromanager</span><span class="o">.</span><span class="n">end_date</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="c1"># Timer: starting day, final day and model output</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="p">)</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">()</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="c1"># Driving variables</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">weatherdataprovider</span> <span class="o">=</span> <span class="n">weatherdataprovider</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">drv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_driving_variables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="c1"># Component for simulation of soil processes</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="o">.</span><span class="n">SOIL</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="o">.</span><span class="n">SOIL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">,</span> <span class="n">parameterprovider</span><span class="p">)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="c1"># Call AgroManagement module for management actions at initialization</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agromanager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drv</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="c1"># Calculate initial rates</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">calc_rates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drv</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="diffwofost.physical_models.utils.EngineTestHelper" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">diffwofost.physical_models.utils.EngineTestHelper</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">EngineTestHelper</span><span class="p">(</span><span class="n">parameterprovider</span><span class="p">,</span> <span class="n">weatherdataprovider</span><span class="p">,</span> <span class="n">agromanagement</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">external_states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            diffwofost.physical_models.engine.Engine" href="#diffwofost.physical_models.engine.Engine">Engine</a></code></p>



        <p>An engine which is purely for running the YAML unit tests.</p>

          












                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/diffwofost/physical_models/utils.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">parameterprovider</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">weatherdataprovider</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">agromanagement</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">config</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">external_states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">BaseEngine</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="c1"># If a path is given, load the model configuration from a PCSE config file</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">from_pcse_config_file</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span> <span class="o">=</span> <span class="n">config</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">parameterprovider</span> <span class="o">=</span> <span class="n">parameterprovider</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="c1"># Configure device and dtype on crop module class if it supports them</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="o">.</span><span class="n">CROP</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="o">.</span><span class="n">CROP</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="o">.</span><span class="n">CROP</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="o">.</span><span class="n">CROP</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="c1"># Variable kiosk for registering and publishing variables</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span> <span class="o">=</span> <span class="n">VariableKioskTestHelper</span><span class="p">(</span><span class="n">external_states</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="c1"># Placeholder for variables to be saved during a model run</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_saved_output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_saved_summary_output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_saved_terminal_output</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="c1"># register handlers for starting/finishing the crop simulation, for</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="c1"># handling output and terminating the system</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_connect_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_CROP_START</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">crop_start</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_connect_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_CROP_FINISH</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">crop_finish</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_connect_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_OUTPUT</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_connect_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_TERMINATE</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">terminate</span><span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="c1"># Component for agromanagement</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agromanager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="o">.</span><span class="n">AGROMANAGEMENT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">,</span> <span class="n">agromanagement</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agromanager</span><span class="o">.</span><span class="n">start_date</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agromanager</span><span class="o">.</span><span class="n">end_date</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="c1"># Timer: starting day, final day and model output</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">delt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">()</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="c1"># Update external states in the kiosk</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="c1"># Driving variables</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">weatherdataprovider</span> <span class="o">=</span> <span class="n">weatherdataprovider</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">drv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_driving_variables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="c1"># Component for simulation of soil processes</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="o">.</span><span class="n">SOIL</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mconf</span><span class="o">.</span><span class="n">SOIL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kiosk</span><span class="p">,</span> <span class="n">parameterprovider</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="c1"># Call AgroManagement module for management actions at initialization</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">agromanager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drv</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="c1"># Calculate initial rates</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">calc_rates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drv</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">












  </div>

    </div>

</div>







  
  




  



                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "content.code.copy", "content.tabs"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>